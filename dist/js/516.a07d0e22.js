"use strict";(self["webpackChunkhosp"]=self["webpackChunkhosp"]||[]).push([[516,839,691],{839:function(e,a,l){l.r(a),l.d(a,{default:function(){return p}});l(7658);var t=l(3396),o=l(4870),i=l(4901),n=l(7178),r=l(2655);const d={class:"dialog-footer"},u={name:"EditDialog"};var s=Object.assign(u,{props:{changeDepartmentDialogVisible:{type:Boolean,required:!0,default:!1},roomList:{type:Array,required:!0,default:()=>[]}},emits:["update:changeDepartmentDialogVisible","handleSubmit"],setup(e,{emit:a}){const l=e,u=(0,t.Fl)({get(){return l.changeDepartmentDialogVisible},set(e){a("update:changeDepartmentDialogVisible",e)}}),s=(0,o.iH)({id:[],departmentId:0}),m=(0,o.iH)([]),p=(0,o.qj)({departmentId:[{required:!0,message:"所属科室不能为空",trigger:"blur"}]}),c=(0,o.iH)(null),g=async e=>{let a=[];for(const o of l.roomList)a.push(o.id);s.value={id:a,departmentId:0},console.log("清空表单...");let t=await i.ZP.get("/api/bsns/departments");if(console.log(t.data),20010==t.data.code){let e=[];t.data.departmentList.forEach((a=>{a.name="+ "+a.name,e.push(a),a.children.forEach((a=>{a.name="••• "+a.name,e.push(a)}))})),m.value=e}else(0,n.z8)({message:t.data.msg,type:"error"})},f=e=>{r.T.confirm("确认在未保存的情况下关闭对话框？").then((()=>{e()})).catch((()=>{}))},b=()=>{u.value=!1},h=()=>{c.value.validate((async e=>{if(e){let e,l;console.log("提交修改..."),e="/api/bsns/rooms/updateDepartment/"+s.value.id.join(",")+"/"+s.value.departmentId,console.log("url=",e),l=await i.ZP.put(e,s.value),console.log("修改诊室科室 res.data= ",l.data),20020==l.data.code||20030==l.data.code?((0,n.z8)({message:l.data.msg,type:"success"}),a("handleSubmit"),b()):(0,n.z8)({message:l.data.msg,type:"error"})}}))};return(0,t.YP)(u,(e=>{1==e&&g()})),(e,a)=>{const l=(0,t.up)("el-option"),i=(0,t.up)("el-select"),n=(0,t.up)("el-form-item"),r=(0,t.up)("el-form"),v=(0,t.up)("el-button"),w=(0,t.up)("el-dialog");return(0,t.wg)(),(0,t.j4)(w,{modelValue:(0,o.SU)(u),"onUpdate:modelValue":a[1]||(a[1]=e=>(0,o.dq)(u)?u.value=e:null),title:"批量修改科室","before-close":f,width:"600px",draggable:""},{footer:(0,t.w5)((()=>[(0,t._)("span",d,[(0,t.Wm)(v,{onClick:g},{default:(0,t.w5)((()=>[(0,t.Uk)("重置")])),_:1}),(0,t.Wm)(v,{onClick:b},{default:(0,t.w5)((()=>[(0,t.Uk)("取消")])),_:1}),(0,t.Wm)(v,{type:"primary",onClick:h},{default:(0,t.w5)((()=>[(0,t.Uk)("确定")])),_:1})])])),default:(0,t.w5)((()=>[(0,t.Wm)(r,{ref_key:"editFormRef",ref:c,model:s.value,rules:p,inline:"","label-width":"80px","label-position":"right","status-icon":""},{default:(0,t.w5)((()=>[(0,t.Wm)(n,{label:"所属科室",prop:"departmentId",style:{width:"48%"}},{default:(0,t.w5)((()=>[(0,t.Wm)(i,{modelValue:s.value.departmentId,"onUpdate:modelValue":a[0]||(a[0]=e=>s.value.departmentId=e),placeholder:"请选择所属科室"},{default:(0,t.w5)((()=>[(0,t.Wm)(l,{label:"顶级科室",value:0}),((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)(m.value,(e=>((0,t.wg)(),(0,t.j4)(l,{key:e.id,label:e.name,value:e.id},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1})])),_:1},8,["model","rules"])])),_:1},8,["modelValue"])}}});const m=s;var p=m},4691:function(e,a,l){l.r(a),l.d(a,{default:function(){return p}});l(7658);var t=l(3396),o=l(4870),i=l(4901),n=l(7178),r=l(2655);const d={class:"dialog-footer"},u={name:"EditDialog"};var s=Object.assign(u,{props:{editDialogVisible:{type:Boolean,required:!0,default:!1},id:{type:Number,required:!0,default:-1},title:{type:String,required:!0,default:""}},emits:["update:editDialogVisible","handleSubmit"],setup(e,{emit:a}){const l=e,u=(0,t.Fl)({get(){return l.editDialogVisible},set(e){a("update:editDialogVisible",e)}}),s=(0,o.iH)({id:-1,roomNo:"",departmentId:0,disabled:!1,note:""}),m=(0,o.iH)([]),p=async(e,a,l)=>{let t;if("roomNo"==e.field&&(a&&a.length>8?l(new Error("诊室号长度不可超过8位")):t="/api/bsns/rooms/checkRoom?id="+s.value.id+"&roomNo="+a),t){let e=await i.ZP.post(t);1==e.data.code?l(new Error(e.data.msg)):l()}},c=(0,o.qj)({departmentId:[{required:!0,message:"所属科室不能为空",trigger:"blur"}],roomNo:[{required:!0,message:"诊室号不能为空",trigger:"blur"},{validator:p,trigger:"change"},{validator:p,trigger:"blur"}],disabled:[{required:!0,message:"状态不能为空",trigger:"blur"}],note:[{required:!1,max:192,message:"备注信息不可超过192个字符",trigger:"blur"}]}),g=(0,o.iH)(null),f=async e=>{if(-1==e)s.value={id:-1,roomNo:"",departmentId:0,disabled:!1,note:""},console.log("清空表单...");else{let a=await i.ZP.get("/api/bsns/rooms/"+e);if(console.log(a.data),20010==a.data.code){let e=a.data.room;s.value=e}else(0,n.z8)({message:a.data.msg,type:"error"});console.log("从后台填充...")}let a=await i.ZP.get("/api/bsns/departments");if(console.log(a.data),20010==a.data.code){let e=[];a.data.departmentList.forEach((a=>{a.name="+ "+a.name,e.push(a),a.children.forEach((a=>{a.name="••• "+a.name,e.push(a)}))})),m.value=e}else(0,n.z8)({message:a.data.msg,type:"error"})},b=e=>{r.T.confirm("确认在未保存的情况下关闭对话框？").then((()=>{e()})).catch((()=>{}))},h=()=>{u.value=!1},v=()=>{g.value.validate((async e=>{if(e){let e,l;-1==s.value.id?(console.log("提交新增..."),e="/api/bsns/rooms",l=await i.ZP.post(e,s.value),console.log("新增诊室 res.data= ",l.data)):(console.log("提交修改..."),e="/api/bsns/rooms",l=await i.ZP.put(e,s.value),console.log("修改诊室 res.data= ",l.data)),20020==l.data.code||20030==l.data.code?((0,n.z8)({message:l.data.msg,type:"success"}),a("handleSubmit"),h()):(0,n.z8)({message:l.data.msg,type:"error"})}}))};return(0,t.YP)(u,(e=>{1==e&&f(l.id)})),(a,l)=>{const i=(0,t.up)("el-option"),n=(0,t.up)("el-select"),r=(0,t.up)("el-form-item"),p=(0,t.up)("el-input"),w=(0,t.up)("el-form"),y=(0,t.up)("el-button"),k=(0,t.up)("el-dialog");return(0,t.wg)(),(0,t.j4)(k,{modelValue:(0,o.SU)(u),"onUpdate:modelValue":l[4]||(l[4]=e=>(0,o.dq)(u)?u.value=e:null),title:e.title,"before-close":b,width:"600px",draggable:""},{footer:(0,t.w5)((()=>[(0,t._)("span",d,[(0,t.Wm)(y,{onClick:l[3]||(l[3]=a=>f(e.id))},{default:(0,t.w5)((()=>[(0,t.Uk)("重置")])),_:1}),(0,t.Wm)(y,{onClick:h},{default:(0,t.w5)((()=>[(0,t.Uk)("取消")])),_:1}),(0,t.Wm)(y,{type:"primary",onClick:v},{default:(0,t.w5)((()=>[(0,t.Uk)("确定")])),_:1})])])),default:(0,t.w5)((()=>[(0,t.Wm)(w,{ref_key:"editFormRef",ref:g,model:s.value,rules:c,inline:"","label-width":"80px","label-position":"right","status-icon":""},{default:(0,t.w5)((()=>[(0,t.Wm)(r,{label:"所属科室",prop:"departmentId",style:{width:"48%"}},{default:(0,t.w5)((()=>[(0,t.Wm)(n,{modelValue:s.value.departmentId,"onUpdate:modelValue":l[0]||(l[0]=e=>s.value.departmentId=e),placeholder:"请选择所属科室"},{default:(0,t.w5)((()=>[(0,t.Wm)(i,{label:"顶级科室",value:0}),((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)(m.value,(e=>((0,t.wg)(),(0,t.j4)(i,{key:e.id,label:e.name,value:e.id},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),(0,t.Wm)(r,{label:"诊室号",prop:"roomNo",style:{width:"100%"}},{default:(0,t.w5)((()=>[(0,t.Wm)(p,{modelValue:s.value.roomNo,"onUpdate:modelValue":l[1]||(l[1]=e=>s.value.roomNo=e),type:"number"},null,8,["modelValue"])])),_:1}),(0,t.Wm)(r,{label:"备注",prop:"note",style:{width:"100%"}},{default:(0,t.w5)((()=>[(0,t.Wm)(p,{modelValue:s.value.note,"onUpdate:modelValue":l[2]||(l[2]=e=>s.value.note=e),type:"textarea",rows:5},null,8,["modelValue"])])),_:1})])),_:1},8,["model","rules"])])),_:1},8,["modelValue","title"])}}});const m=s;var p=m},2516:function(e,a,l){l.r(a),l.d(a,{default:function(){return h}});l(7658);var t=l(3396),o=l(9242),i=l(4870),n=l(2748),r=l(4901),d=l(4691),u=l(839),s=l(5410),m=l.n(s),p=l(7178);const c={name:"index"};var g=Object.assign(c,{setup(e){const a=(0,i.qj)({query:"",currentPage:1,pageSize:15}),l=(0,i.iH)(""),s=(0,i.iH)(40),c=(0,i.iH)(!0),g=(0,i.iH)([]),f=(0,i.iH)(400),b=(0,i.iH)([{id:10075286712,roomNo:103,departmentId:0,departmentInfo:{id:0,name:"顶级科室"},disabled:!1,note:"通用诊室",createTime:"2022-09-23 20:10:01",updateTime:"2022-10-18 18:16:18"},{id:1007448077,roomNo:104,departmentId:0,departmentInfo:{id:0,name:"顶级科室"},disabled:!1,note:"通用诊室2号",createTime:"2022-09-23 20:10:01",updateTime:"2022-10-18 18:16:18"}]),h=(0,i.iH)(!1),v=(0,i.iH)(!1),w=(0,i.iH)(-1),y=(0,i.iH)(""),k=()=>{a.currentPage=1,a.query==l.value?(console.log("手动刷新：关键字不变..."),q()):a.query=l.value},W=async e=>{e?e=[e]:(e=[],g.value.forEach((a=>{e.push(a.id)}))),console.log("删除...",e);let a="/api/bsns/rooms/"+e.join(",");console.log("url=",a);let l=await r.ZP.del(a);console.log("res=",l),20040==l.data.code?((0,p.z8)({message:l.data.msg,type:"success"}),await q()):(0,p.z8)({message:l.data.msg,type:"error"})},_=e=>{e?(console.log("修改...",e),w.value=e,y.value="诊室修改"):(console.log("新增...",e),w.value=-1,y.value="诊室添加"),h.value=!0},S=e=>{console.log("批量更改科室...",g),v.value=!0},V=e=>{console.log(`${e} items per page`)},U=e=>{console.log(`current page: ${e}`)},z=e=>{g.value=e,c.value=0==e.length,console.log("新选择= ",e)},q=async()=>{let e="/api/bsns/rooms?"+m().stringify(a);console.log("url=",e);let l=await r.ZP.get(e);console.log("更新诊室列表 res= ",l),20010==l.data.code?(b.value=l.data.roomList,s.value=l.data.total):(0,p.z8)({message:l.data.msg,type:"error"})};q(),(0,t.YP)(a,(async(e,l)=>{if(e.pageSize!=l.pageSize){let a=l.pageSize*(l.currentPage-1)+1;e.currentPage=Math.ceil(a/e.pageSize)}console.log(Date.now()+" 重新拉取数据..."),console.log(a),await q()}));const D=new ResizeObserver((e=>{for(const a of e)if("mainView"==a.target.id){let e;if(a.contentBoxSize){const l=Array.isArray(a.contentBoxSize)?a.contentBoxSize[0]:a.contentBoxSize;e=l.blockSize}else e=a.contentRect.height;f.value=e}}));return(0,t.bv)((()=>{const e=document.getElementById("mainView");D.observe(e)})),(e,r)=>{const m=(0,t.up)("el-input"),p=(0,t.up)("el-col"),D=(0,t.up)("el-button"),x=(0,t.up)("el-popconfirm"),P=(0,t.up)("el-row"),H=(0,t.up)("el-header"),C=(0,t.up)("el-table-column"),I=(0,t.up)("el-table"),j=(0,t.up)("el-main"),A=(0,t.up)("el-pagination"),N=(0,t.up)("el-footer"),E=(0,t.up)("el-container");return(0,t.wg)(),(0,t.iD)(t.HY,null,[(0,t.Wm)(E,null,{default:(0,t.w5)((()=>[(0,t.Wm)(H,{class:"operatingFloor"},{default:(0,t.w5)((()=>[(0,t.Wm)(P,{gutter:20},{default:(0,t.w5)((()=>[(0,t.Wm)(p,{span:7},{default:(0,t.w5)((()=>[(0,t.Wm)(m,{modelValue:l.value,"onUpdate:modelValue":r[0]||(r[0]=e=>l.value=e),placeholder:"搜索诊室...",onKeyup:(0,o.D2)(k,["enter"]),clearable:""},null,8,["modelValue","onKeyup"])])),_:1}),(0,t.Wm)(D,{type:"primary",icon:(0,i.SU)(n.Search),onClick:k},{default:(0,t.w5)((()=>[(0,t.Uk)("查询")])),_:1},8,["icon"]),e.hasAnyAuthority("business:room:add")?((0,t.wg)(),(0,t.j4)(D,{key:0,type:"success",icon:(0,i.SU)(n.DocumentAdd),onClick:r[1]||(r[1]=e=>_(null))},{default:(0,t.w5)((()=>[(0,t.Uk)("新增 ")])),_:1},8,["icon"])):(0,t.kq)("",!0),e.hasAnyAuthority("business:room:edit")?((0,t.wg)(),(0,t.j4)(D,{key:1,type:"warning",icon:(0,i.SU)(n.Paperclip),onClick:S,disabled:c.value},{default:(0,t.w5)((()=>[(0,t.Uk)("批量更改科室 ")])),_:1},8,["icon","disabled"])):(0,t.kq)("",!0),e.hasAnyAuthority("business:room:delete")?((0,t.wg)(),(0,t.j4)(x,{key:2,title:"您确定要批量删除这些记录吗？",onConfirm:r[2]||(r[2]=e=>W(null))},{reference:(0,t.w5)((()=>[(0,t.Wm)(D,{type:"danger",icon:(0,i.SU)(n.Delete),disabled:c.value},{default:(0,t.w5)((()=>[(0,t.Uk)("批量删除")])),_:1},8,["icon","disabled"])])),_:1})):(0,t.kq)("",!0)])),_:1})])),_:1}),(0,t.Wm)(j,{style:{padding:"5px",background:"aliceblue"},id:"mainView"},{default:(0,t.w5)((()=>[(0,t.Wm)(I,{data:b.value,"max-height":f.value,"default-sort":{prop:"id",order:"ascending"},size:"default",onSelectionChange:z,style:{width:"100%"},"highlight-current-row":"","default-expand-all":"",stripe:""},{default:(0,t.w5)((()=>[(0,t.Wm)(C,{type:"selection",width:"40",align:"center"}),(0,t.Wm)(C,{prop:"roomNo",label:"诊室号",width:"100","header-align":"center",sortable:"",fixed:""}),(0,t.Wm)(C,{prop:"departmentInfo.name",label:"所属科室",width:"120","header-align":"center",sortable:"",fixed:""}),(0,t.Wm)(C,{prop:"note",label:"备注",width:"200","header-align":"center"}),(0,t.Wm)(C,{prop:"createTime",label:"创建时间",width:"160","header-align":"center",sortable:""}),(0,t.Wm)(C,{prop:"updateTime",label:"更新时间","min-width":"160","header-align":"left",sortable:""}),(0,t.Wm)(C,{label:"操作",width:"130",align:"right","header-align":"center",fixed:"right"},{default:(0,t.w5)((a=>[e.hasAnyAuthority("business:room:edit")?((0,t.wg)(),(0,t.j4)(D,{key:0,type:"primary",icon:(0,i.SU)(n.Edit),onClick:e=>_(a.row.id)},null,8,["icon","onClick"])):(0,t.kq)("",!0),e.hasAnyAuthority("business:room:delete")?((0,t.wg)(),(0,t.j4)(x,{key:1,title:"您确定要删除这条记录吗？",onConfirm:e=>W(a.row.id)},{reference:(0,t.w5)((()=>[(0,t.Wm)(D,{type:"danger",icon:(0,i.SU)(n.Delete)},null,8,["icon"])])),_:2},1032,["onConfirm"])):(0,t.kq)("",!0)])),_:1})])),_:1},8,["data","max-height"])])),_:1}),(0,t.Wm)(N,{style:{background:"powderblue",height:"32px",display:"flex","align-items":"center","justify-content":"flex-end"}},{default:(0,t.w5)((()=>[(0,t.Wm)(A,{currentPage:a.currentPage,"onUpdate:currentPage":r[3]||(r[3]=e=>a.currentPage=e),"page-size":a.pageSize,"onUpdate:page-size":r[4]||(r[4]=e=>a.pageSize=e),"page-sizes":[15,20,50,100],small:"",background:"",layout:"total, sizes, prev, pager, next, jumper",total:s.value,onSizeChange:V,onCurrentChange:U},null,8,["currentPage","page-size","total"])])),_:1})])),_:1}),(0,t.Wm)((0,i.SU)(d["default"]),{"edit-dialog-visible":h.value,"onUpdate:edit-dialog-visible":r[5]||(r[5]=e=>h.value=e),id:w.value,title:y.value,onHandleSubmit:q},null,8,["edit-dialog-visible","id","title"]),(0,t.Wm)((0,i.SU)(u["default"]),{"change-department-dialog-visible":v.value,"onUpdate:change-department-dialog-visible":r[6]||(r[6]=e=>v.value=e),"room-list":g.value,onHandleSubmit:q},null,8,["change-department-dialog-visible","room-list"])],64)}}}),f=l(89);const b=(0,f.Z)(g,[["__scopeId","data-v-1f67a470"]]);var h=b}}]);
//# sourceMappingURL=516.a07d0e22.js.map