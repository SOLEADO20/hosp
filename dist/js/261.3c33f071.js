"use strict";(self["webpackChunkhosp"]=self["webpackChunkhosp"]||[]).push([[261],{3819:function(e,l,t){t.d(l,{Z:function(){return d}});var a=t(3396),n=t(7139);function u(e,l,t,u,i,s){const o=(0,a.up)("el-icon"),d=(0,a.up)("el-menu-item"),m=(0,a.up)("el-sub-menu"),r=(0,a.up)("el-menu"),p=(0,a.up)("el-scrollbar");return(0,a.wg)(),(0,a.j4)(p,null,{default:(0,a.w5)((()=>[(0,a.Wm)(r,null,{default:(0,a.w5)((()=>[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(t.menuData,(l=>((0,a.wg)(),(0,a.iD)(a.HY,{key:l.path+l.name},[void 0!=l.children&&l.children.length>0?((0,a.wg)(),(0,a.j4)(m,{key:0,index:l.path+l.name},{title:(0,a.w5)((()=>[(0,a.Wm)(o,null,{default:(0,a.w5)((()=>[""!=l.icon?((0,a.wg)(),(0,a.j4)((0,a.LL)(l.icon),{key:0})):(0,a.kq)("",!0)])),_:2},1024),(0,a.Uk)(" "+(0,n.zw)(l.name),1)])),default:(0,a.w5)((()=>[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(l.children,(t=>((0,a.wg)(),(0,a.j4)(d,{key:t.path+t.name,index:t.path+t.name,onClick:a=>e.$emit("selectMenu",l,t)},{title:(0,a.w5)((()=>[(0,a.Wm)(o,null,{default:(0,a.w5)((()=>[""!=t.icon?((0,a.wg)(),(0,a.j4)((0,a.LL)(t.icon),{key:0})):(0,a.kq)("",!0)])),_:2},1024),(0,a.Uk)(" "+(0,n.zw)(t.name),1)])),_:2},1032,["index","onClick"])))),128))])),_:2},1032,["index"])):((0,a.wg)(),(0,a.j4)(d,{key:1,index:l.path+l.name,onClick:t=>e.$emit("selectMenu",l)},{title:(0,a.w5)((()=>[(0,a.Wm)(o,null,{default:(0,a.w5)((()=>[""!=l.icon?((0,a.wg)(),(0,a.j4)((0,a.LL)(l.icon),{key:0})):(0,a.kq)("",!0)])),_:2},1024),(0,a.Uk)(" "+(0,n.zw)(l.name),1)])),_:2},1032,["index","onClick"]))],64)))),128))])),_:1})])),_:1})}var i={name:"Menu",props:["menuData"]},s=t(89);const o=(0,s.Z)(i,[["render",u]]);var d=o},7261:function(e,l,t){t.r(l),t.d(l,{default:function(){return S}});t(7658);var a=t(3396),n=t(4870),u=t(7139),i=t(4239),s=t(2748),o=t(4901),d=t(7178),m=t(3819),r=t(5410),p=t.n(r);const c=e=>((0,a.dD)("data-v-450309e4"),e=e(),(0,a.Cn)(),e),w={class:"cell-item"},f={class:"cell-item"},g={class:"cell-item"},v={class:"cell-item"},k={class:"cell-item"},_={class:"cell-item"},y={key:0,style:{color:"#E6A23C"}},W={key:1,style:{color:"#67C23A"}},h={key:2,style:{color:"#F56C6C"}},b={key:3,style:{color:"#909399"}},U={class:"cell-item"},x=c((()=>(0,a._)("div",{class:"flex-grow"},null,-1))),D={name:"index"};var I=Object.assign(D,{setup(e){const l=(0,n.iH)(i.Z.getters.GET_USERINFO),t=(0,n.qj)({doctorId:l.value.personId,status:0,startDate:null,endDate:null});let r=(0,n.iH)([]);const c=(0,n.iH)([]),D=(0,n.iH)(-1),I=(0,n.iH)({id:-1,createTime:"",sequence:"",status:4,prescription:null,remark:null,patientInfo:{id:-1,name:"",idNo:"",sex:null,tel:""},departmentInfo:{id:-1,name:""},roomInfo:{id:-1,roomNo:"",note:""},scheduleInfo:{id:-1,date:"",time:-1}}),z=[{text:"一周内",value:()=>{const e=new Date,l=new Date;return l.setTime(l.getTime()-6048e5),[l,e]}},{text:"一个月内",value:()=>{const e=new Date,l=new Date;return l.setTime(l.getTime()-2592e6),[l,e]}},{text:"三个月内",value:()=>{const e=new Date,l=new Date;return l.setTime(l.getTime()-7776e6),[l,e]}}],C=(0,n.qj)({prescription:[{required:!0,message:"诊断结果不能为空",trigger:"blur"},{max:500,message:"诊断结果不可超过500个字符",trigger:"blur"}]}),S=(0,n.iH)(null),j=e=>{console.log(e),e?(t.startDate=H(e[0]),t.endDate=H(e[1])):(t.startDate=null,t.endDate=null)},T=e=>{D.value=e.path,console.log(e.path),F()},V=async e=>{console.log("关闭订单...",e);let l="/api/clinic/appointments/"+e;console.log("url=",l);let t=await o.ZP.del(l);console.log("res=",t),20040==t.data.code?((0,d.z8)({message:t.data.msg,type:"success"}),await F()):(0,d.z8)({message:t.data.msg,type:"error"})},q=async e=>{console.log("跳过订单...",e);let l="/api/clinic/appointments/skipAppointment/"+e;console.log("url=",l);let t=await o.ZP.del(l);console.log("res=",t),20040==t.data.code?((0,d.z8)({message:t.data.msg,type:"success"}),await F()):(0,d.z8)({message:t.data.msg,type:"error"})},Z=()=>{S.value.validate((async e=>{if(e){let e,l;console.log("提交诊断结果..."),e="/api/clinic/appointments",l=await o.ZP.put(e,I.value),console.log("修改订单 res.data= ",l.data),20020==l.data.code||20030==l.data.code?((0,d.z8)({message:l.data.msg,type:"success"}),await F()):(0,d.z8)({message:l.data.msg,type:"error"})}}))},H=e=>{let l=e.getFullYear(),t=e.getMonth()+1,a=e.getDate(),n=l+"-"+(t<10?"0"+t:t)+"-"+(a<10?"0"+a:a);return console.log("dateToStr dateDate=",e,", dateStr=",n),n},F=async()=>{let e="/api/clinic/appointments?"+p().stringify(t);console.log(e);let l=await o.ZP.get(e);if(console.log("更新预约信息 res= ",l),20010==l.data.code){let e=[];l.data.appointmentList.forEach((l=>{let t={name:l.sequence+" "+l.patientInfo.name+" ... "+(0==l.status?"待就诊":1==l.status?"已就诊":2==l.status?"已取消":3==l.status?"已过期":"错误")+(l.isSkipped?"（暂时跳过）":""),path:l.id};e.push(t)})),r.value=e}else(0,d.z8)({message:l.data.msg,type:"error"});if(-1!=D.value){let e="/api/clinic/appointments/"+D.value;console.log(e);let l=await o.ZP.get(e);console.log("更新预约信息 res= ",l),20010==l.data.code?I.value=l.data.appointment:(I.value={id:-1,createTime:"",sequence:"",status:4,prescription:null,remark:null,patientInfo:{id:-1,name:"",idNo:"",sex:null,tel:""},departmentInfo:{id:-1,name:""},roomInfo:{id:-1,roomNo:"",note:""},scheduleInfo:{id:-1,date:"",time:-1}},(0,d.z8)({message:l.data.msg,type:"error"}))}};return F(),(0,a.YP)(t,(async(e,l)=>{console.log(Date.now()+" 重新拉取数据..."),console.log(t),await F()})),(e,l)=>{const i=(0,a.up)("el-date-picker"),o=(0,a.up)("el-option"),d=(0,a.up)("el-select"),p=(0,a.up)("el-header"),D=(0,a.up)("el-aside"),H=(0,a.up)("el-icon"),F=(0,a.up)("el-descriptions-item"),A=(0,a.up)("el-descriptions"),L=(0,a.up)("el-input"),P=(0,a.up)("el-form-item"),N=(0,a.up)("el-button"),E=(0,a.up)("el-popconfirm"),M=(0,a.up)("el-form"),Y=(0,a.up)("el-scrollbar"),K=(0,a.up)("el-main"),O=(0,a.up)("el-container");return(0,a.wg)(),(0,a.j4)(O,null,{default:(0,a.w5)((()=>[(0,a.Wm)(p,{class:"operatingFloor"},{default:(0,a.w5)((()=>[(0,a.Wm)(i,{modelValue:c.value,"onUpdate:modelValue":l[0]||(l[0]=e=>c.value=e),type:"daterange","unlink-panels":"","range-separator":"到","start-placeholder":"开始日期","end-placeholder":"结束日期",shortcuts:z,size:"default",onChange:j,style:{float:"left"}},null,8,["modelValue"]),(0,a.Wm)(d,{modelValue:t.status,"onUpdate:modelValue":l[1]||(l[1]=e=>t.status=e),placeholder:"请选择订单类型",style:{float:"left","margin-left":"12px"}},{default:(0,a.w5)((()=>[(0,a.Wm)(o,{label:"待就诊",value:0}),(0,a.Wm)(o,{label:"已就诊",value:1}),(0,a.Wm)(o,{label:"已取消",value:2}),(0,a.Wm)(o,{label:"已过期",value:3}),(0,a.Wm)(o,{label:"全部",value:""})])),_:1},8,["modelValue"])])),_:1}),(0,a.Wm)(O,null,{default:(0,a.w5)((()=>[(0,a.Wm)(D,{width:"250px"},{default:(0,a.w5)((()=>[(0,a.Wm)((0,n.SU)(m.Z),{"menu-data":(0,n.SU)(r),onSelectMenu:T},null,8,["menu-data"])])),_:1}),(0,a.Wm)(O,null,{default:(0,a.w5)((()=>[(0,a.Wm)(p,{style:{height:"100px",padding:"8px 10px"}},{default:(0,a.w5)((()=>[(0,a.Wm)(A,{column:4,size:"default",border:""},{default:(0,a.w5)((()=>[(0,a.Wm)(F,null,{label:(0,a.w5)((()=>[(0,a._)("div",w,[(0,a.Wm)(H,null,{default:(0,a.w5)((()=>[(0,a.Wm)((0,n.SU)(s.User))])),_:1}),(0,a.Uk)(" 姓名 ")])])),default:(0,a.w5)((()=>[(0,a.Uk)(" "+(0,u.zw)(I.value.patientInfo.name),1)])),_:1}),(0,a.Wm)(F,null,{label:(0,a.w5)((()=>[(0,a._)("div",f,[(0,a.Wm)(H,null,{default:(0,a.w5)((()=>[(0,a.Wm)((0,n.SU)(s.QuestionFilled))])),_:1}),(0,a.Uk)(" 性别 ")])])),default:(0,a.w5)((()=>[(0,a.Uk)(" "+(0,u.zw)(0==I.value.patientInfo.sex?"男":1==I.value.patientInfo.sex?"女":""),1)])),_:1}),(0,a.Wm)(F,null,{label:(0,a.w5)((()=>[(0,a._)("div",g,[(0,a.Wm)(H,null,{default:(0,a.w5)((()=>[(0,a.Wm)((0,n.SU)(s.InfoFilled))])),_:1}),(0,a.Uk)(" 身份证号 ")])])),default:(0,a.w5)((()=>[(0,a.Uk)(" "+(0,u.zw)(I.value.patientInfo.idNo),1)])),_:1}),(0,a.Wm)(F,null,{label:(0,a.w5)((()=>[(0,a._)("div",v,[(0,a.Wm)(H,null,{default:(0,a.w5)((()=>[(0,a.Wm)((0,n.SU)(s.Iphone))])),_:1}),(0,a.Uk)(" 手机号 ")])])),default:(0,a.w5)((()=>[(0,a.Uk)(" "+(0,u.zw)(I.value.patientInfo.tel),1)])),_:1}),(0,a.Wm)(F,null,{label:(0,a.w5)((()=>[(0,a._)("div",k,[(0,a.Wm)(H,null,{default:(0,a.w5)((()=>[(0,a.Wm)((0,n.SU)(s.Clock))])),_:1}),(0,a.Uk)(" 预约时段 ")])])),default:(0,a.w5)((()=>[(0,a.Uk)(" "+(0,u.zw)(I.value.scheduleInfo.date)+" "+(0,u.zw)(0==I.value.scheduleInfo.time?"上午":1==I.value.scheduleInfo.time?"下午":""),1)])),_:1}),(0,a.Wm)(F,null,{label:(0,a.w5)((()=>[(0,a._)("div",_,[(0,a.Wm)(H,null,{default:(0,a.w5)((()=>[(0,a.Wm)((0,n.SU)(s.QuestionFilled))])),_:1}),(0,a.Uk)(" 订单状态 ")])])),default:(0,a.w5)((()=>[0==I.value.status?((0,a.wg)(),(0,a.iD)("span",y,"待就诊")):1==I.value.status?((0,a.wg)(),(0,a.iD)("span",W,"已就诊")):2==I.value.status?((0,a.wg)(),(0,a.iD)("span",h,"已取消")):3==I.value.status?((0,a.wg)(),(0,a.iD)("span",b,"已过期")):(0,a.kq)("",!0)])),_:1}),(0,a.Wm)(F,null,{label:(0,a.w5)((()=>[(0,a._)("div",U,[(0,a.Wm)(H,null,{default:(0,a.w5)((()=>[(0,a.Wm)((0,n.SU)(s.EditPen))])),_:1}),(0,a.Uk)(" 最后提交时间 ")])])),default:(0,a.w5)((()=>[(0,a.Uk)(" "+(0,u.zw)(I.value.updateTime?I.value.updateTime:I.value.createTime),1)])),_:1})])),_:1})])),_:1}),(0,a.Wm)(K,{style:{padding:"5px",background:"aliceblue"},id:"mainView"},{default:(0,a.w5)((()=>[(0,a.Wm)(Y,null,{default:(0,a.w5)((()=>[(0,a.Wm)(M,{ref_key:"editFormRef",ref:S,model:I.value,rules:C,inline:"","label-width":"80px","label-position":"right","status-icon":""},{default:(0,a.w5)((()=>[(0,a.Wm)(P,{label:"诊断结果",prop:"prescription",style:{width:"100%"}},{default:(0,a.w5)((()=>[(0,a.Wm)(L,{modelValue:I.value.prescription,"onUpdate:modelValue":l[2]||(l[2]=e=>I.value.prescription=e),type:"textarea",rows:12},null,8,["modelValue"])])),_:1}),(0,a.Wm)(P,{label:" ",prop:"",style:{width:"100%"}},{default:(0,a.w5)((()=>[e.hasAnyAuthority("clinic:appointment:edit")?((0,a.wg)(),(0,a.j4)(E,{key:0,title:"您确定要暂时跳过该订单吗？",onConfirm:l[3]||(l[3]=e=>q(I.value.id))},{reference:(0,a.w5)((()=>[(0,a.Wm)(N,{style:{width:"25%"},disabled:I.value.isSkipped||0!=I.value.status},{default:(0,a.w5)((()=>[(0,a.Uk)("跳过此单")])),_:1},8,["disabled"])])),_:1})):(0,a.kq)("",!0),e.hasAnyAuthority("clinic:appointment:edit")?((0,a.wg)(),(0,a.j4)(E,{key:1,title:"您确定要关闭该订单吗？",onConfirm:l[4]||(l[4]=e=>V(I.value.id))},{reference:(0,a.w5)((()=>[(0,a.Wm)(N,{type:"danger",style:{width:"20%"},disabled:0!=I.value.status},{default:(0,a.w5)((()=>[(0,a.Uk)("关闭订单")])),_:1},8,["disabled"])])),_:1})):(0,a.kq)("",!0),x,(0,a.Wm)(N,{type:"primary",style:{width:"50%"},onClick:Z,disabled:0!=I.value.status},{default:(0,a.w5)((()=>[(0,a.Uk)("提交诊断")])),_:1},8,["disabled"])])),_:1}),(0,a.Wm)(P,{label:"用户评价",prop:"remark",style:{width:"100%"}},{default:(0,a.w5)((()=>[(0,a.Wm)(L,{modelValue:I.value.remark,"onUpdate:modelValue":l[5]||(l[5]=e=>I.value.remark=e),type:"textarea",rows:10,disabled:""},null,8,["modelValue"])])),_:1})])),_:1},8,["model","rules"])])),_:1})])),_:1})])),_:1})])),_:1})])),_:1})}}}),z=t(89);const C=(0,z.Z)(I,[["__scopeId","data-v-450309e4"]]);var S=C}}]);
//# sourceMappingURL=261.3c33f071.js.map