"use strict";(self["webpackChunkhosp"]=self["webpackChunkhosp"]||[]).push([[794],{7794:function(e,l,a){a.r(l),a.d(l,{default:function(){return k}});var o=a(3396),r=a(4870),s=a(9242),t=a(4901),i=a(128),u=a(680),m=a(2748),n=a(3527),d=a(5410),c=a.n(d),p=a(4239),g=a(1120),f=a(2655),w=a(7178),y=a(2483),b=a(9847);const h=e=>((0,o.dD)("data-v-cf3e5660"),e=e(),(0,o.Cn)(),e),v={class:"loginPage"},Z=h((()=>(0,o._)("h3",{class:"formTitle"},"科王飙医院 门诊服务",-1))),_={class:"securityCodeWrapper"},U=["src"],C={name:"LoginDialog"};var V=Object.assign(C,{setup(e){(0,y.yj)();const l=(0,r.iH)(!0),a=(0,r.qj)({username:"",password:"",securityCode:"",rememberMe:!1,uuid:""}),d=e=>{f.T.confirm("暂不登录？").then((()=>{e(),g.Z.replace({path:p.Z.state.editableTabsValue})})).catch((()=>{}))};let h=(0,r.iH)("");const C=(0,r.qj)({username:[{required:!0,message:"请输入您的账号",trigger:"blur"}],password:[{required:!0,message:"请输入您的密码",trigger:"blur"}],securityCode:[{required:!0,message:"请输入验证码",trigger:"change"}]}),V=async()=>{let e=await t.ZP.get("/captcha");console.log("captcha res= ",e),a.uuid=e.data.uuid,a.securityCode="",h.value=e.data.base64Img},W=(0,r.iH)(null),x=(0,r.iH)(!1),k=()=>{console.log("login!"),console.log("loginFormRef.value= ",W.value),W.value.validate((async e=>{if(console.log("valid= ",e),e){console.log("表单验证通过"),a.rememberMe?(console.log("记住密码"),u.Z.set("username",a.username,{expires:7}),u.Z.set("password",(0,n.H)(a.password,{expires:7})),u.Z.set("rememberMe",a.rememberMe,{expires:7})):(console.log("不记住密码"),u.Z.remove("username"),u.Z.remove("password"),u.Z.remove("rememberMe")),console.log("stringify loginForm=",c().stringify(a));try{let e=await t.ZP.post("login?"+c().stringify(a));if(200==e.data.code){console.log("res.data= ",e.data);const l=e.data.authorization,a=e.data.menuList,o=e.data.perms,r=e.data.currentUser;p.Z.commit("SET_TOKEN",l),p.Z.commit("SET_MENULIST",a),p.Z.commit("SET_PERMS",o),p.Z.commit("SET_USERINFO",r),g.Z.replace({path:p.Z.state.editableTabsValue}),(0,w.z8)({message:"登录成功.",type:"success"})}else(0,w.z8)({showClose:!0,message:e.data.msg,type:"error"}),await V()}catch(l){console.log("login e= ",l),(0,w.z8)({showClose:!0,message:"哎呀呀~出错了嚯！\n"+l,type:"error"}),await V()}}else console.log("表单验证不通过"),(0,w.z8)({message:"请将信息填写完整",type:"warning"})}))},S=()=>{console.log("register!"),x.value=!0},M=()=>{const e=u.Z.get("username"),l=u.Z.get("password"),o=u.Z.get("rememberMe");a.username=void 0==e?a.username:e,a.password=void 0==l?a.password:(0,n.p)(l),a.rememberMe=void 0==o?a.rememberMe:o};return V(),M(),(e,t)=>{const u=(0,o.up)("el-input"),n=(0,o.up)("el-form-item"),c=(0,o.up)("el-checkbox"),p=(0,o.up)("el-button"),g=(0,o.up)("el-form"),f=(0,o.up)("el-dialog");return(0,o.wg)(),(0,o.iD)(o.HY,null,[(0,o.Wm)(f,{modelValue:l.value,"onUpdate:modelValue":t[4]||(t[4]=e=>l.value=e),title:"请登录","before-close":d,width:"700px",center:"",draggable:""},{default:(0,o.w5)((()=>[(0,o._)("div",v,[(0,o.Wm)(g,{model:a,rules:C,ref_key:"loginFormRef",ref:W,class:"loginForm"},{default:(0,o.w5)((()=>[Z,(0,o.Wm)(n,{prop:"username"},{default:(0,o.w5)((()=>[(0,o.Wm)(u,{modelValue:a.username,"onUpdate:modelValue":t[0]||(t[0]=e=>a.username=e),type:"text",size:"large",autocomplete:"off",placeholder:"用户名 / 手机号 / 身份证号","prefix-icon":(0,r.SU)(m.User)},null,8,["modelValue","prefix-icon"])])),_:1}),(0,o.Wm)(n,{prop:"password"},{default:(0,o.w5)((()=>[(0,o.Wm)(u,{modelValue:a.password,"onUpdate:modelValue":t[1]||(t[1]=e=>a.password=e),type:"password",size:"large",autocomplete:"off",placeholder:"密码","prefix-icon":(0,r.SU)(m.Lock),onKeyup:(0,s.D2)(k,["enter"]),"show-password":""},null,8,["modelValue","prefix-icon","onKeyup"])])),_:1}),(0,o.Wm)(n,{prop:"securityCode"},{default:(0,o.w5)((()=>[(0,o.Wm)(u,{modelValue:a.securityCode,"onUpdate:modelValue":t[2]||(t[2]=e=>a.securityCode=e),type:"text",size:"large",autocomplete:"off",placeholder:"验证码","prefix-icon":(0,r.SU)(m.CircleCheck),onKeyup:(0,s.D2)(k,["enter"]),style:{width:"67%"}},null,8,["modelValue","prefix-icon","onKeyup"]),(0,o._)("div",_,[(0,o._)("img",{src:(0,r.SU)(h),onClick:V,alt:"刷新验证码"},null,8,U)])])),_:1}),(0,o.Wm)(n,null,{default:(0,o.w5)((()=>[(0,o.Wm)(c,{label:"记住密码",modelValue:a.rememberMe,"onUpdate:modelValue":t[3]||(t[3]=e=>a.rememberMe=e)},null,8,["modelValue"])])),_:1}),(0,o.Wm)(n,{style:{width:"100%"}},{default:(0,o.w5)((()=>[(0,o.Wm)(p,{type:"primary",size:"small",onClick:S,style:{width:"auto",margin:"auto","letter-spacing":"1px"},text:""},{default:(0,o.w5)((()=>[(0,o.Uk)(">>注 册<< ")])),_:1})])),_:1}),(0,o.Wm)(n,null,{default:(0,o.w5)((()=>[(0,o.Wm)(p,{type:"primary",size:"large",onClick:k,style:{width:"100%"}},{default:(0,o.w5)((()=>[(0,o.Uk)("登 录")])),_:1})])),_:1})])),_:1},8,["model","rules"]),(0,o.Wm)((0,r.SU)(i.Z),{class:"loginPageFooter"})])])),_:1},8,["modelValue"]),(0,o.Wm)((0,r.SU)(b["default"]),{"register-dialog-visible":x.value,"onUpdate:register-dialog-visible":t[5]||(t[5]=e=>x.value=e)},null,8,["register-dialog-visible"])],64)}}}),W=a(89);const x=(0,W.Z)(V,[["__scopeId","data-v-cf3e5660"]]);var k=x}}]);
//# sourceMappingURL=794.be06258f.js.map