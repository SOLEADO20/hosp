"use strict";(self["webpackChunkhosp"]=self["webpackChunkhosp"]||[]).push([[252,31],{7031:function(e,a,t){t.r(a),t.d(a,{default:function(){return c}});var l=t(3396),n=t(4870),i=t(4901),o=t(7178),r=t(2655);const d={class:"dialog-footer"},u={name:"EditDialog"};var s=Object.assign(u,{props:{editDialogVisible:{type:Boolean,required:!0,default:!1},id:{type:Number,required:!0,default:-1},title:{type:String,required:!0,default:""}},emits:["update:editDialogVisible","handleSubmit"],setup(e,{emit:a}){const t=e,u=(0,l.Fl)({get(){return t.editDialogVisible},set(e){a("update:editDialogVisible",e)}}),s=(0,n.iH)({id:-1,parentId:0,name:"",disabled:!1,note:""}),p=(0,n.iH)([]),c=async(e,a,t)=>{let l;if("name"==e.field&&(a&&a.length>16?t(new Error("科室名称长度不可超过16位")):l="/api/bsns/departments/checkDepartment?id="+s.value.id+"&name="+a),l){let e=await i.ZP.post(l);1==e.data.code?t(new Error(e.data.msg)):t()}},g=(0,n.qj)({parentId:[{required:!0,message:"上级科室不能为空",trigger:"blur"}],name:[{required:!0,message:"科室名称不能为空",trigger:"blur"},{validator:c,trigger:"change"},{validator:c,trigger:"blur"}],disabled:[{required:!0,message:"状态不能为空",trigger:"blur"}],note:[{required:!1,max:300,message:"科室介绍不可超过300个字符",trigger:"blur"}]}),m=(0,n.iH)(null),b=async e=>{if(-1==e)s.value={id:-1,parentId:0,name:"",disabled:!1,note:""},console.log("清空表单...");else{let a=await i.ZP.get("/api/bsns/departments/"+e);if(console.log(a.data),20010==a.data.code){let e=a.data.department;s.value=e}else(0,o.z8)({message:a.data.msg,type:"error"});console.log("从后台填充...")}let a=await i.ZP.get("/api/bsns/departments");if(console.log(a.data),20010==a.data.code){let e=a.data.departmentList;p.value=e}else(0,o.z8)({message:a.data.msg,type:"error"})},f=e=>{r.T.confirm("确认在未保存的情况下关闭对话框？").then((()=>{e()})).catch((()=>{}))},w=()=>{u.value=!1},h=()=>{m.value.validate((async e=>{if(e){let e,t;-1==s.value.id?(console.log("提交新增..."),e="/api/bsns/departments",t=await i.ZP.post(e,s.value),console.log("新增科室 res.data= ",t.data)):(console.log("提交修改..."),e="/api/bsns/departments",t=await i.ZP.put(e,s.value),console.log("修改科室 res.data= ",t.data)),20020==t.data.code||20030==t.data.code?((0,o.z8)({message:t.data.msg,type:"success"}),a("handleSubmit"),w()):(0,o.z8)({message:t.data.msg,type:"error"})}}))};return(0,l.YP)(u,(e=>{1==e&&b(t.id)})),(a,t)=>{const i=(0,l.up)("el-option"),o=(0,l.up)("el-select"),r=(0,l.up)("el-form-item"),c=(0,l.up)("el-input"),v=(0,l.up)("el-form"),y=(0,l.up)("el-button"),k=(0,l.up)("el-dialog");return(0,l.wg)(),(0,l.j4)(k,{modelValue:(0,n.SU)(u),"onUpdate:modelValue":t[4]||(t[4]=e=>(0,n.dq)(u)?u.value=e:null),title:e.title,"before-close":f,width:"600px",draggable:""},{footer:(0,l.w5)((()=>[(0,l._)("span",d,[(0,l.Wm)(y,{onClick:t[3]||(t[3]=a=>b(e.id))},{default:(0,l.w5)((()=>[(0,l.Uk)("重置")])),_:1}),(0,l.Wm)(y,{onClick:w},{default:(0,l.w5)((()=>[(0,l.Uk)("取消")])),_:1}),(0,l.Wm)(y,{type:"primary",onClick:h},{default:(0,l.w5)((()=>[(0,l.Uk)("确定")])),_:1})])])),default:(0,l.w5)((()=>[(0,l.Wm)(v,{ref_key:"editFormRef",ref:m,model:s.value,rules:g,inline:"","label-width":"80px","label-position":"right","status-icon":""},{default:(0,l.w5)((()=>[(0,l.Wm)(r,{label:"父节点",prop:"parentId",style:{width:"48%"}},{default:(0,l.w5)((()=>[(0,l.Wm)(o,{modelValue:s.value.parentId,"onUpdate:modelValue":t[0]||(t[0]=e=>s.value.parentId=e),placeholder:"请选择上级科室"},{default:(0,l.w5)((()=>[(0,l.Wm)(i,{label:"顶级科室",value:0}),((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)(p.value,(e=>((0,l.wg)(),(0,l.j4)(i,{key:e.id,label:"+ "+e.name,value:e.id},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),(0,l.Wm)(r,{label:"科室名称",prop:"name",style:{width:"100%"}},{default:(0,l.w5)((()=>[(0,l.Wm)(c,{modelValue:s.value.name,"onUpdate:modelValue":t[1]||(t[1]=e=>s.value.name=e)},null,8,["modelValue"])])),_:1}),(0,l.Wm)(r,{label:"科室介绍",prop:"note",style:{width:"100%"}},{default:(0,l.w5)((()=>[(0,l.Wm)(c,{modelValue:s.value.note,"onUpdate:modelValue":t[2]||(t[2]=e=>s.value.note=e),type:"textarea",rows:5},null,8,["modelValue"])])),_:1})])),_:1},8,["model","rules"])])),_:1},8,["modelValue","title"])}}});const p=s;var c=p},2252:function(e,a,t){t.r(a),t.d(a,{default:function(){return f}});t(7658);var l=t(3396),n=t(9242),i=t(4870),o=t(2748),r=t(4901),d=t(7031),u=t(5410),s=t.n(u),p=t(7178);const c={name:"index"};var g=Object.assign(c,{setup(e){const a=(0,i.qj)({query:"",currentPage:1,pageSize:10}),t=(0,i.iH)(""),u=(0,i.iH)(40),c=(0,i.iH)(!0),g=(0,i.iH)([]),m=(0,i.iH)(400),b=(0,i.iH)([{id:10075286712,name:"外科",disabled:!1,note:"",createTime:"2022-09-23 20:10:01",updateTime:"2022-10-18 18:16:18",children:[]},{id:1007448077,name:"内科",disabled:!1,note:"",createTime:"2022-09-23 20:10:01",updateTime:"2022-10-18 18:16:18",children:[{id:1007448078,name:"神经内科",disabled:!0,note:"",createTime:"2022-09-23 20:10:01",updateTime:"2022-10-18 18:16:18",children:[]}]}]),f=(0,i.iH)(!1),w=(0,i.iH)(-1),h=(0,i.iH)(""),v=()=>{a.currentPage=1,a.query==t.value?(console.log("手动刷新：关键字不变..."),_()):a.query=t.value},y=async e=>{e?e=[e]:(e=[],g.value.forEach((a=>{e.push(a.id)}))),console.log("删除...",e);let a="/api/bsns/departments/"+e.join(",");console.log("url=",a);let t=await r.ZP.del(a);console.log("res=",t),20040==t.data.code?((0,p.z8)({message:t.data.msg,type:"success"}),await _()):(0,p.z8)({message:t.data.msg,type:"error"})},k=e=>{e?(console.log("修改...",e),w.value=e,h.value="科室修改"):(console.log("新增...",e),w.value=-1,h.value="科室添加"),f.value=!0},W=e=>{console.log(`${e} items per page`)},z=e=>{console.log(`current page: ${e}`)},S=e=>{g.value=e,c.value=0==e.length,console.log("新选择= ",e)},_=async()=>{let e="/api/bsns/departments?"+s().stringify(a);console.log("url=",e);let t=await r.ZP.get(e);console.log("更新科室列表 res= ",t),20010==t.data.code?(b.value=t.data.departmentList,u.value=t.data.total):(0,p.z8)({message:t.data.msg,type:"error"})};_(),(0,l.YP)(a,(async(e,t)=>{if(e.pageSize!=t.pageSize){let a=t.pageSize*(t.currentPage-1)+1;e.currentPage=Math.ceil(a/e.pageSize)}console.log(Date.now()+" 重新拉取数据..."),console.log(a),await _()}));const V=new ResizeObserver((e=>{for(const a of e)if("mainView"==a.target.id){let e;if(a.contentBoxSize){const t=Array.isArray(a.contentBoxSize)?a.contentBoxSize[0]:a.contentBoxSize;e=t.blockSize}else e=a.contentRect.height;m.value=e}}));return(0,l.bv)((()=>{const e=document.getElementById("mainView");V.observe(e)})),(e,r)=>{const s=(0,l.up)("el-input"),p=(0,l.up)("el-col"),g=(0,l.up)("el-button"),V=(0,l.up)("el-popconfirm"),U=(0,l.up)("el-row"),x=(0,l.up)("el-header"),q=(0,l.up)("el-table-column"),P=(0,l.up)("el-table"),C=(0,l.up)("el-main"),H=(0,l.up)("el-pagination"),j=(0,l.up)("el-footer"),D=(0,l.up)("el-container");return(0,l.wg)(),(0,l.iD)(l.HY,null,[(0,l.Wm)(D,null,{default:(0,l.w5)((()=>[(0,l.Wm)(x,{class:"operatingFloor"},{default:(0,l.w5)((()=>[(0,l.Wm)(U,{gutter:20},{default:(0,l.w5)((()=>[(0,l.Wm)(p,{span:7},{default:(0,l.w5)((()=>[(0,l.Wm)(s,{modelValue:t.value,"onUpdate:modelValue":r[0]||(r[0]=e=>t.value=e),placeholder:"搜索科室...",onKeyup:(0,n.D2)(v,["enter"]),clearable:""},null,8,["modelValue","onKeyup"])])),_:1}),(0,l.Wm)(g,{type:"primary",icon:(0,i.SU)(o.Search),onClick:v},{default:(0,l.w5)((()=>[(0,l.Uk)("查询")])),_:1},8,["icon"]),e.hasAnyAuthority("business:department:add")?((0,l.wg)(),(0,l.j4)(g,{key:0,type:"success",icon:(0,i.SU)(o.DocumentAdd),onClick:r[1]||(r[1]=e=>k(null))},{default:(0,l.w5)((()=>[(0,l.Uk)("新增")])),_:1},8,["icon"])):(0,l.kq)("",!0),e.hasAnyAuthority("business:department:delete")?((0,l.wg)(),(0,l.j4)(V,{key:1,title:"您确定要批量删除这些记录吗？",onConfirm:r[2]||(r[2]=e=>y(null))},{reference:(0,l.w5)((()=>[(0,l.Wm)(g,{type:"danger",icon:(0,i.SU)(o.Delete),disabled:c.value},{default:(0,l.w5)((()=>[(0,l.Uk)("批量删除")])),_:1},8,["icon","disabled"])])),_:1})):(0,l.kq)("",!0)])),_:1})])),_:1}),(0,l.Wm)(C,{style:{padding:"5px",background:"aliceblue"},id:"mainView"},{default:(0,l.w5)((()=>[(0,l.Wm)(P,{data:b.value,"max-height":m.value,"default-sort":{prop:"id",order:"ascending"},"row-key":"id",indent:25,size:"default",onSelectionChange:S,style:{width:"100%"},"highlight-current-row":"","default-expand-all":"",stripe:""},{default:(0,l.w5)((()=>[(0,l.Wm)(q,{type:"selection",width:"40",align:"center"}),(0,l.Wm)(q,{prop:"name",label:"科室名称",width:"200","header-align":"center",sortable:"",fixed:""}),(0,l.Wm)(q,{prop:"createTime",label:"创建时间",width:"160","header-align":"center",sortable:""}),(0,l.Wm)(q,{prop:"updateTime",label:"更新时间",width:"160","header-align":"center",sortable:""}),(0,l.Wm)(q,{prop:"note",label:"科室介绍","min-width":"200","header-align":"center"}),(0,l.Wm)(q,{label:"操作",width:"130",align:"right","header-align":"center",fixed:"right"},{default:(0,l.w5)((a=>[e.hasAnyAuthority("business:department:edit")?((0,l.wg)(),(0,l.j4)(g,{key:0,type:"primary",icon:(0,i.SU)(o.Edit),onClick:e=>k(a.row.id)},null,8,["icon","onClick"])):(0,l.kq)("",!0),e.hasAnyAuthority("business:department:delete")?((0,l.wg)(),(0,l.j4)(V,{key:1,title:"您确定要删除这条记录吗？",onConfirm:e=>y(a.row.id)},{reference:(0,l.w5)((()=>[(0,l.Wm)(g,{type:"danger",icon:(0,i.SU)(o.Delete)},null,8,["icon"])])),_:2},1032,["onConfirm"])):(0,l.kq)("",!0)])),_:1})])),_:1},8,["data","max-height"])])),_:1}),u.value>0?((0,l.wg)(),(0,l.j4)(j,{key:0,style:{background:"powderblue",height:"32px",display:"flex","align-items":"center","justify-content":"flex-end"}},{default:(0,l.w5)((()=>[(0,l.Wm)(H,{currentPage:a.currentPage,"onUpdate:currentPage":r[3]||(r[3]=e=>a.currentPage=e),"page-size":a.pageSize,"onUpdate:page-size":r[4]||(r[4]=e=>a.pageSize=e),"page-sizes":[5,10,20,50,100],small:"",background:"",layout:"total, sizes, prev, pager, next, jumper",total:u.value,onSizeChange:W,onCurrentChange:z},null,8,["currentPage","page-size","total"])])),_:1})):(0,l.kq)("",!0)])),_:1}),(0,l.Wm)((0,i.SU)(d["default"]),{"edit-dialog-visible":f.value,"onUpdate:edit-dialog-visible":r[5]||(r[5]=e=>f.value=e),id:w.value,title:h.value,onHandleSubmit:_},null,8,["edit-dialog-visible","id","title"])],64)}}}),m=t(89);const b=(0,m.Z)(g,[["__scopeId","data-v-ce2c612a"]]);var f=b}}]);
//# sourceMappingURL=252.81703af5.js.map