"use strict";(self["webpackChunkhosp"]=self["webpackChunkhosp"]||[]).push([[54,675],{8675:function(e,l,t){t.r(l),t.d(l,{default:function(){return f}});var a=t(3396),i=t(4870),n=t(4901),o=t(2655),d=t(7178),u=t(2748);const r={class:"dialog-footer"},s={name:"EditDialog"};var m=Object.assign(s,{props:{editDialogVisible:{type:Boolean,required:!0,default:!1},userId:{type:Number,required:!0,default:-1}},emits:["update:editDialogVisible","handleSubmit"],setup(e,{emit:l}){const t=e,s=(0,a.Fl)({get(){return t.editDialogVisible},set(e){l("update:editDialogVisible",e)}}),m=(0,i.iH)({id:-1,userId:t.userId,patientId:-1,relation:"",note:"",patientInfo:{id:-1,name:"",idNo:"",sex:!1,tel:""}}),p=(0,i.qj)(["父亲","母亲","爷爷","奶奶","哥哥","弟弟","姐姐","妹妹"]),f=async(e,l,t)=>{if("patientInfo.idNo"==e.field){let e=/^[1-9]\d{5}(18|19|20)\d{2}((0[1-9])|(1[0-2]))(([0-2][1-9])|10|20|30|31)\d{3}[0-9Xx]$/;e.test(l)?t():t(new Error("请输入正确的身份证号"))}else if("patientInfo.tel"==e.field){let e=/^(13[0-9]|14[01456879]|15[0-35-9]|16[2567]|17[0-8]|18[0-9]|19[0-35-9])\d{8}$/;e.test(l)?t():t(new Error("请输入正确的手机号"))}},c=(0,i.qj)({"patientInfo.name":[{required:!0,message:"姓名不能为空",trigger:"blur"},{min:2,max:16,message:"请输入正确的姓名",trigger:"blur"}],"patientInfo.idNo":[{required:!0,message:"身份证号不能为空",trigger:"blur"},{validator:f,trigger:"change"},{validator:f,trigger:"blur"}],"patientInfo.tel":[{required:!0,message:"手机号不能为空",trigger:"blur"},{validator:f,trigger:"change"},{validator:f,trigger:"blur"}],"patientInfo.sex":[{required:!0,message:"性别不能为空",trigger:"blur"}],relation:[{required:!0,message:"关系不能为空",trigger:"blur"},{max:6,message:"关系信息不可超过6个字符 ",trigger:"blur"}],note:[{required:!1,max:192,message:"备注信息不可超过192个字符",trigger:"blur"}]}),g=(0,i.iH)(null),w=async()=>{m.value={id:-1,userId:t.userId,patientId:-1,relation:"",note:"",patientInfo:{id:-1,name:"",idNo:"",sex:!1,tel:""}},console.log("清空表单...")},v=e=>{o.T.confirm("确认在未保存的情况下关闭对话框？").then((()=>{e()})).catch((()=>{}))},b=()=>{s.value=!1},_=()=>{g.value.validate((async e=>{if(e){let e,t;-1==m.value.id&&(console.log("提交新增..."),e="/api/center/patients",t=await n.ZP.post(e,m.value),console.log("新增就诊人 res.data= ",t.data)),20020==t.data.code?((0,d.z8)({message:t.data.msg,type:"success"}),l("handleSubmit"),b()):(0,d.z8)({message:t.data.msg,type:"error"})}}))};return(0,a.YP)(s,(e=>{1==e&&w()})),(e,l)=>{const t=(0,a.up)("el-input"),n=(0,a.up)("el-form-item"),o=(0,a.up)("el-switch"),d=(0,a.up)("el-option"),f=(0,a.up)("el-select"),W=(0,a.up)("el-form"),I=(0,a.up)("el-button"),y=(0,a.up)("el-dialog");return(0,a.wg)(),(0,a.j4)(y,{modelValue:(0,i.SU)(s),"onUpdate:modelValue":l[7]||(l[7]=e=>(0,i.dq)(s)?s.value=e:null),title:"就诊人添加","before-close":v,width:"600px",draggable:""},{footer:(0,a.w5)((()=>[(0,a._)("span",r,[(0,a.Wm)(I,{onClick:l[6]||(l[6]=e=>w())},{default:(0,a.w5)((()=>[(0,a.Uk)("重置")])),_:1}),(0,a.Wm)(I,{onClick:b},{default:(0,a.w5)((()=>[(0,a.Uk)("取消")])),_:1}),(0,a.Wm)(I,{type:"primary",onClick:_},{default:(0,a.w5)((()=>[(0,a.Uk)("确定")])),_:1})])])),default:(0,a.w5)((()=>[(0,a.Wm)(W,{ref_key:"editFormRef",ref:g,model:m.value,rules:c,inline:"","label-width":"80px","label-position":"right","status-icon":""},{default:(0,a.w5)((()=>[(0,a.Wm)(n,{label:"姓名",prop:"patientInfo.name",style:{width:"48%"}},{default:(0,a.w5)((()=>[(0,a.Wm)(t,{modelValue:m.value.patientInfo.name,"onUpdate:modelValue":l[0]||(l[0]=e=>m.value.patientInfo.name=e)},null,8,["modelValue"])])),_:1}),(0,a.Wm)(n,{label:"电话",prop:"patientInfo.tel",style:{width:"40%"}},{default:(0,a.w5)((()=>[(0,a.Wm)(t,{modelValue:m.value.patientInfo.tel,"onUpdate:modelValue":l[1]||(l[1]=e=>m.value.patientInfo.tel=e)},null,8,["modelValue"])])),_:1}),(0,a.Wm)(n,{label:"身份证号",prop:"patientInfo.idNo",style:{width:"100%"}},{default:(0,a.w5)((()=>[(0,a.Wm)(t,{modelValue:m.value.patientInfo.idNo,"onUpdate:modelValue":l[2]||(l[2]=e=>m.value.patientInfo.idNo=e)},null,8,["modelValue"])])),_:1}),(0,a.Wm)(n,{label:"性别",prop:"patientInfo.sex",style:{width:"48%"}},{default:(0,a.w5)((()=>[(0,a.Wm)(o,{modelValue:m.value.patientInfo.sex,"onUpdate:modelValue":l[3]||(l[3]=e=>m.value.patientInfo.sex=e),style:{"--el-switch-on-color":"#f89898","--el-switch-off-color":"#409EFF"},"active-icon":(0,i.SU)(u.Female),"inactive-icon":(0,i.SU)(u.Male),"active-value":!0,"inactive-value":!1,width:"50px"},null,8,["modelValue","active-icon","inactive-icon"])])),_:1}),(0,a.Wm)(n,{label:"关系",prop:"relation",style:{width:"100%"}},{default:(0,a.w5)((()=>[(0,a.Wm)(f,{modelValue:m.value.relation,"onUpdate:modelValue":l[4]||(l[4]=e=>m.value.relation=e),filterable:"","allow-create":"","default-first-option":"","reserve-keyword":!1},{default:(0,a.w5)((()=>[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(p,(e=>((0,a.wg)(),(0,a.j4)(d,{key:e,label:e,value:e},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),(0,a.Wm)(n,{label:"备注",prop:"note",style:{width:"100%"}},{default:(0,a.w5)((()=>[(0,a.Wm)(t,{modelValue:m.value.note,"onUpdate:modelValue":l[5]||(l[5]=e=>m.value.note=e),type:"textarea",rows:5},null,8,["modelValue"])])),_:1})])),_:1},8,["model","rules"])])),_:1},8,["modelValue"])}}});const p=m;var f=p},6054:function(e,l,t){t.r(l),t.d(l,{default:function(){return k}});t(541);var a=t(3396),i=t(4870),n=t(7139),o=t(4239),d=t(2748),u=t(4901),r=t(7178),s=t(8675);const m=e=>((0,a.dD)("data-v-e6c9d4a4"),e=e(),(0,a.Cn)(),e),p={class:"card-header"},f=m((()=>(0,a._)("span",null,"就诊人信息卡",-1))),c={class:"cell-item"},g={class:"cell-item"},w={class:"cell-item"},v={class:"cell-item"},b={class:"cell-item"},_={class:"cell-item"},W={name:"index"};var I=Object.assign(W,{setup(e){const l=(0,i.iH)(o.Z.getters.GET_USERINFO),t=(0,i.iH)({id:-1,name:"",idNo:"",tel:void 0,sex:!1,disabled:!1}),m=(0,i.iH)([]),W=(0,i.iH)(!1),I=()=>{W.value=!0},y=async e=>{console.log("删除...",e);let l="/api/center/patients/"+e;console.log("url=",l);let t=await u.ZP.del(l);console.log("res=",t),20040==t.data.code?((0,r.z8)({message:t.data.msg,type:"success"}),await U()):(0,r.z8)({message:t.data.msg,type:"error"})},U=async()=>{let e=await u.ZP.get("/api/center/users/"+l.value.id),a=await u.ZP.get("/api/center/patients?userId="+l.value.id);if(console.log("更新用户信息 res= ",e),console.log("更新就诊人信息 res= ",a),20010==e.data.code&&20010==a.data.code){let l=e.data.user.personInfo;t.value=l;let i={id:-1,userId:e.data.user.id,patientId:l.id,relation:"本人",note:"无",patientInfo:l};m.value=a.data.patientList,m.value.unshift(i)}else(0,r.z8)({message:e.data.msg,type:"error"})};return U(),(e,t)=>{const o=(0,a.up)("el-button"),u=(0,a.up)("el-row"),r=(0,a.up)("el-header"),k=(0,a.up)("el-popconfirm"),h=(0,a.up)("el-icon"),V=(0,a.up)("el-descriptions-item"),x=(0,a.up)("QuestionFilled"),S=(0,a.up)("el-descriptions"),q=(0,a.up)("el-card"),z=(0,a.up)("el-scrollbar"),N=(0,a.up)("el-main"),F=(0,a.up)("el-container");return(0,a.wg)(),(0,a.iD)(a.HY,null,[(0,a.Wm)(F,null,{default:(0,a.w5)((()=>[(0,a.Wm)(r,{class:"operatingFloor"},{default:(0,a.w5)((()=>[(0,a.Wm)(u,{gutter:20},{default:(0,a.w5)((()=>[(0,a.Wm)(o,{type:"primary",onClick:I,style:{"margin-left":"12px"}},{default:(0,a.w5)((()=>[(0,a.Uk)("添加就诊人")])),_:1})])),_:1})])),_:1}),(0,a.Wm)(N,{style:{padding:"5px",background:"aliceblue"},id:"mainView"},{default:(0,a.w5)((()=>[(0,a.Wm)(z,null,{default:(0,a.w5)((()=>[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(m.value,(l=>((0,a.wg)(),(0,a.j4)(q,{key:l.id,style:{"margin-top":"20px","margin-left":"12px",width:"700px",float:"left"}},{header:(0,a.w5)((()=>[(0,a._)("div",p,[f,e.hasAnyAuthority("center:patient:delete")&&-1!=l.id?((0,a.wg)(),(0,a.j4)(k,{key:0,title:"您确定要解绑此卡吗？",onConfirm:e=>y(l.id)},{reference:(0,a.w5)((()=>[(0,a.Wm)(o,{type:"warning"},{default:(0,a.w5)((()=>[(0,a.Uk)("解绑此卡")])),_:1})])),_:2},1032,["onConfirm"])):(0,a.kq)("",!0)])])),default:(0,a.w5)((()=>[(0,a.Wm)(S,{column:3,size:"default",border:""},{default:(0,a.w5)((()=>[(0,a.Wm)(V,null,{label:(0,a.w5)((()=>[(0,a._)("div",c,[(0,a.Wm)(h,null,{default:(0,a.w5)((()=>[(0,a.Wm)((0,i.SU)(d.InfoFilled))])),_:1}),(0,a.Uk)(" 姓名 ")])])),default:(0,a.w5)((()=>[(0,a.Uk)(" "+(0,n.zw)(l.patientInfo.name),1)])),_:2},1024),(0,a.Wm)(V,null,{label:(0,a.w5)((()=>[(0,a._)("div",g,[(0,a.Wm)(h,null,{default:(0,a.w5)((()=>[(0,a.Wm)(x)])),_:1}),(0,a.Uk)(" 性别 ")])])),default:(0,a.w5)((()=>[(0,a.Uk)(" "+(0,n.zw)("0"==l.patientInfo.sex?"男":"女"),1)])),_:2},1024),(0,a.Wm)(V,null,{label:(0,a.w5)((()=>[(0,a._)("div",w,[(0,a.Wm)(h,null,{default:(0,a.w5)((()=>[(0,a.Wm)((0,i.SU)(d.Link))])),_:1}),(0,a.Uk)(" 关系 ")])])),default:(0,a.w5)((()=>[(0,a.Uk)(" "+(0,n.zw)(l.relation),1)])),_:2},1024),(0,a.Wm)(V,null,{label:(0,a.w5)((()=>[(0,a._)("div",v,[(0,a.Wm)(h,null,{default:(0,a.w5)((()=>[(0,a.Wm)((0,i.SU)(d.InfoFilled))])),_:1}),(0,a.Uk)(" 身份证号 ")])])),default:(0,a.w5)((()=>[(0,a.Uk)(" "+(0,n.zw)(l.patientInfo.idNo),1)])),_:2},1024),(0,a.Wm)(V,null,{label:(0,a.w5)((()=>[(0,a._)("div",b,[(0,a.Wm)(h,null,{default:(0,a.w5)((()=>[(0,a.Wm)((0,i.SU)(d.Iphone))])),_:1}),(0,a.Uk)(" 电话 ")])])),default:(0,a.w5)((()=>[(0,a.Uk)(" "+(0,n.zw)(l.patientInfo.tel),1)])),_:2},1024),(0,a.Wm)(V,null,{label:(0,a.w5)((()=>[(0,a._)("div",_,[(0,a.Wm)(h,null,{default:(0,a.w5)((()=>[(0,a.Wm)((0,i.SU)(d.EditPen))])),_:1}),(0,a.Uk)(" 备注 ")])])),default:(0,a.w5)((()=>[(0,a.Uk)(" "+(0,n.zw)(l.note),1)])),_:2},1024)])),_:2},1024)])),_:2},1024)))),128))])),_:1})])),_:1})])),_:1}),(0,a.Wm)((0,i.SU)(s["default"]),{"user-id":l.value.id,"edit-dialog-visible":W.value,"onUpdate:edit-dialog-visible":t[0]||(t[0]=e=>W.value=e),onHandleSubmit:U},null,8,["user-id","edit-dialog-visible"])],64)}}}),y=t(89);const U=(0,y.Z)(I,[["__scopeId","data-v-e6c9d4a4"]]);var k=U}}]);
//# sourceMappingURL=54.b92c49ae.js.map