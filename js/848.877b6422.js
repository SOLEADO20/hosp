"use strict";(self["webpackChunkhosp"]=self["webpackChunkhosp"]||[]).push([[848,174],{9174:function(e,l,a){a.r(l),a.d(l,{default:function(){return m}});var t=a(3396),i=a(4870),o=a(4901),n=a(7178),d=a(2655),r=a(2748);const s={class:"dialog-footer"},u={name:"EditDialog"};var c=Object.assign(u,{props:{editDialogVisible:{type:Boolean,required:!0,default:!1},id:{type:Number,required:!0,default:-1},title:{type:String,required:!0,default:""}},emits:["update:editDialogVisible","handleSubmit"],setup(e,{emit:l}){const a=e,u=(0,t.Fl)({get(){return a.editDialogVisible},set(e){l("update:editDialogVisible",e)}}),c=(0,i.iH)({id:-1,name:"",idNo:"",sex:!1,tel:"",disabled:!1,note:""}),p=async(e,l,a)=>{let t;if("idNo"==e.field){let e=/^[1-9]\d{5}(18|19|20)\d{2}((0[1-9])|(1[0-2]))(([0-2][1-9])|10|20|30|31)\d{3}[0-9Xx]$/;e.test(l)?t="/api/sys/persons/checkPerson?id="+c.value.id+"&idNo="+l:a(new Error("请输入正确的身份证号"))}else if("tel"==e.field){let e=/^(13[0-9]|14[01456879]|15[0-35-9]|16[2567]|17[0-8]|18[0-9]|19[0-35-9])\d{8}$/;e.test(l)?t="/api/sys/persons/checkPerson?id="+c.value.id+"&tel="+l:a(new Error("请输入正确的手机号"))}if(t){let e=await o.ZP.post(t);1==e.data.code?a(new Error(e.data.msg)):a()}},m=(0,i.qj)({name:[{required:!0,message:"姓名不能为空",trigger:"blur"},{min:2,max:16,message:"请输入正确的姓名",trigger:"change"},{min:2,max:16,message:"请输入正确的姓名",trigger:"blur"}],idNo:[{required:!0,message:"身份证号不能为空",trigger:"blur"},{validator:p,trigger:"change"},{validator:p,trigger:"blur"}],tel:[{required:!0,message:"手机号不能为空",trigger:"blur"},{validator:p,trigger:"change"},{validator:p,trigger:"blur"}],disabled:[{required:!0,message:"状态不能为空",trigger:"blur"}],note:[{required:!1,max:192,message:"备注信息不可超过192个字符",trigger:"blur"}]}),g=(0,i.iH)(null),v=async e=>{if(-1==e)c.value={id:-1,name:"",idNo:"",sex:!1,tel:"",disabled:!1,note:""},console.log("清空表单...");else{let l=await o.ZP.get("/api/sys/persons/"+e);if(console.log(l.data),20010==l.data.code){let e=l.data.person;c.value=e}else(0,n.z8)({message:l.data.msg,type:"error"});console.log("从后台填充...")}},w=e=>{d.T.confirm("确认在未保存的情况下关闭对话框？").then((()=>{e()})).catch((()=>{}))},h=()=>{u.value=!1},f=()=>{g.value.validate((async e=>{if(e){let e,a;-1==c.value.id?(console.log("提交新增..."),e="/api/sys/persons",a=await o.ZP.post(e,c.value),console.log("新增身份 res.data= ",a.data)):(console.log("提交修改..."),e="/api/sys/persons",a=await o.ZP.put(e,c.value),console.log("修改身份 res.data= ",a.data)),20020==a.data.code||20030==a.data.code?((0,n.z8)({message:a.data.msg,type:"success"}),l("handleSubmit"),h()):(0,n.z8)({message:a.data.msg,type:"error"})}}))};return(0,t.YP)(u,(e=>{1==e&&v(a.id)})),(l,a)=>{const o=(0,t.up)("el-input"),n=(0,t.up)("el-form-item"),d=(0,t.up)("el-switch"),p=(0,t.up)("el-form"),b=(0,t.up)("el-button"),y=(0,t.up)("el-dialog");return(0,t.wg)(),(0,t.j4)(y,{modelValue:(0,i.SU)(u),"onUpdate:modelValue":a[7]||(a[7]=e=>(0,i.dq)(u)?u.value=e:null),title:e.title,"before-close":w,width:"600px",draggable:""},{footer:(0,t.w5)((()=>[(0,t._)("span",s,[(0,t.Wm)(b,{onClick:a[6]||(a[6]=l=>v(e.id))},{default:(0,t.w5)((()=>[(0,t.Uk)("重置")])),_:1}),(0,t.Wm)(b,{onClick:h},{default:(0,t.w5)((()=>[(0,t.Uk)("取消")])),_:1}),(0,t.Wm)(b,{type:"primary",onClick:f},{default:(0,t.w5)((()=>[(0,t.Uk)("确定")])),_:1})])])),default:(0,t.w5)((()=>[(0,t.Wm)(p,{ref_key:"editFormRef",ref:g,model:c.value,rules:m,inline:"","label-width":"80px","label-position":"right","status-icon":""},{default:(0,t.w5)((()=>[(0,t.Wm)(n,{label:"姓名",prop:"name",style:{width:"48%"}},{default:(0,t.w5)((()=>[(0,t.Wm)(o,{modelValue:c.value.name,"onUpdate:modelValue":a[0]||(a[0]=e=>c.value.name=e)},null,8,["modelValue"])])),_:1}),(0,t.Wm)(n,{label:"电话",prop:"tel",style:{width:"40%"}},{default:(0,t.w5)((()=>[(0,t.Wm)(o,{modelValue:c.value.tel,"onUpdate:modelValue":a[1]||(a[1]=e=>c.value.tel=e)},null,8,["modelValue"])])),_:1}),(0,t.Wm)(n,{label:"身份证号",prop:"idNo",style:{width:"100%"}},{default:(0,t.w5)((()=>[(0,t.Wm)(o,{modelValue:c.value.idNo,"onUpdate:modelValue":a[2]||(a[2]=e=>c.value.idNo=e)},null,8,["modelValue"])])),_:1}),(0,t.Wm)(n,{label:"性别",prop:"sex",style:{width:"48%"}},{default:(0,t.w5)((()=>[(0,t.Wm)(d,{modelValue:c.value.sex,"onUpdate:modelValue":a[3]||(a[3]=e=>c.value.sex=e),style:{"--el-switch-on-color":"#f89898","--el-switch-off-color":"#409EFF"},"active-icon":(0,i.SU)(r.Female),"inactive-icon":(0,i.SU)(r.Male),"active-value":!0,"inactive-value":!1,width:"50px"},null,8,["modelValue","active-icon","inactive-icon"])])),_:1}),(0,t.Wm)(n,{label:"状态",prop:"disabled",style:{width:"40%"}},{default:(0,t.w5)((()=>[(0,t.Wm)(d,{modelValue:c.value.disabled,"onUpdate:modelValue":a[4]||(a[4]=e=>c.value.disabled=e),style:{"--el-switch-on-color":"#13ce66","--el-switch-off-color":"#ff4949"},"active-text":"启用","inactive-text":"禁用","active-value":!1,"inactive-value":!0,width:"50px"},null,8,["modelValue"])])),_:1}),(0,t.Wm)(n,{label:"备注",prop:"note",style:{width:"100%"}},{default:(0,t.w5)((()=>[(0,t.Wm)(o,{modelValue:c.value.note,"onUpdate:modelValue":a[5]||(a[5]=e=>c.value.note=e),type:"textarea",rows:5},null,8,["modelValue"])])),_:1})])),_:1},8,["model","rules"])])),_:1},8,["modelValue","title"])}}});const p=c;var m=p},848:function(e,l,a){a.r(l),a.d(l,{default:function(){return w}});a(7658);var t=a(3396),i=a(9242),o=a(4870),n=a(2748),d=a(4901),r=a(9174),s=a(5410),u=a.n(s),c=a(7178);const p={name:"index"};var m=Object.assign(p,{setup(e){const l=(0,o.qj)({query:"",currentPage:1,pageSize:15}),a=(0,o.iH)(""),s=(0,o.iH)(40),p=(0,o.iH)(!0),m=(0,o.iH)([]),g=(0,o.iH)(400),v=(0,o.iH)([{id:10075286712,name:"陈嘉乐",idNo:"430111200012310089",sex:!0,tel:18877776666,disabled:!1,note:"",createTime:"2022-09-23 20:10:01",updateTime:"2022-10-18 18:16:18"},{id:1007448077,name:"李佳",idNo:"511502199103223189",sex:!0,tel:18877776666,disabled:!1,note:"",createTime:"2022-09-23 20:10:01",updateTime:"2022-10-18 18:16:18"}]),w=(0,o.iH)(!1),h=(0,o.iH)(-1),f=(0,o.iH)(""),b=()=>{l.currentPage=1,l.query==a.value?(console.log("手动刷新：关键字不变..."),_()):l.query=a.value},y=async e=>{e?e=[e]:(e=[],m.value.forEach((l=>{e.push(l.id)}))),console.log("删除...",e);let l="/api/sys/persons/"+e.join(",");console.log("url=",l);let a=await d.ZP.del(l);console.log("res=",a),20040==a.data.code?((0,c.z8)({message:a.data.msg,type:"success"}),await _()):(0,c.z8)({message:a.data.msg,type:"error"})},x=e=>{e?(console.log("修改...",e),h.value=e,f.value="身份修改"):(console.log("新增...",e),h.value=-1,f.value="身份添加"),w.value=!0},W=e=>{console.log(`${e} items per page`)},V=e=>{console.log(`current page: ${e}`)},k=e=>{m.value=e,p.value=0==e.length,console.log("新选择= ",e)},U=async e=>{e.loading=!0;let l="/api/sys/persons/updateDisabled/"+e.id+"/"+e.disabled;try{let a=await d.ZP.put(l);20030==a.data.code?(0,c.z8)({message:a.data.msg,type:"success"}):((0,c.z8)({message:a.data.msg,type:"error"}),e.disabled=!e.disabled)}catch(a){console.log("e=",a),(0,c.z8)({message:"操作失败！"+a,type:"error"}),e.disabled=!e.disabled}e.loading=!1},S=(e,l)=>l.disabled===e,_=async()=>{let e="/api/sys/persons?"+u().stringify(l);console.log("url=",e);let a=await d.ZP.get(e);console.log("更新身份列表 res= ",a),20010==a.data.code?(v.value=a.data.personList,s.value=a.data.total):(0,c.z8)({message:a.data.msg,type:"error"})};_(),(0,t.YP)(l,(async(e,a)=>{if(e.pageSize!=a.pageSize){let l=a.pageSize*(a.currentPage-1)+1;e.currentPage=Math.ceil(l/e.pageSize)}console.log(Date.now()+" 重新拉取数据..."),console.log(l),await _()}));const z=new ResizeObserver((e=>{for(const l of e)if("mainView"==l.target.id){let e;if(l.contentBoxSize){const a=Array.isArray(l.contentBoxSize)?l.contentBoxSize[0]:l.contentBoxSize;e=a.blockSize}else e=l.contentRect.height;g.value=e}}));return(0,t.bv)((()=>{const e=document.getElementById("mainView");z.observe(e)})),(e,d)=>{const u=(0,t.up)("el-input"),c=(0,t.up)("el-col"),m=(0,t.up)("el-button"),z=(0,t.up)("el-popconfirm"),P=(0,t.up)("el-row"),q=(0,t.up)("el-header"),C=(0,t.up)("el-table-column"),A=(0,t.up)("el-switch"),D=(0,t.up)("el-table"),H=(0,t.up)("el-main"),j=(0,t.up)("el-pagination"),N=(0,t.up)("el-footer"),E=(0,t.up)("el-container");return(0,t.wg)(),(0,t.iD)(t.HY,null,[(0,t.Wm)(E,null,{default:(0,t.w5)((()=>[(0,t.Wm)(q,{class:"operatingFloor"},{default:(0,t.w5)((()=>[(0,t.Wm)(P,{gutter:20},{default:(0,t.w5)((()=>[(0,t.Wm)(c,{span:7},{default:(0,t.w5)((()=>[(0,t.Wm)(u,{modelValue:a.value,"onUpdate:modelValue":d[0]||(d[0]=e=>a.value=e),placeholder:"搜索身份...",onKeyup:(0,i.D2)(b,["enter"]),clearable:""},null,8,["modelValue","onKeyup"])])),_:1}),(0,t.Wm)(m,{type:"primary",icon:(0,o.SU)(n.Search),onClick:b},{default:(0,t.w5)((()=>[(0,t.Uk)("查询")])),_:1},8,["icon"]),e.hasAnyAuthority("system:person:add")?((0,t.wg)(),(0,t.j4)(m,{key:0,type:"success",icon:(0,o.SU)(n.DocumentAdd),onClick:d[1]||(d[1]=e=>x(null))},{default:(0,t.w5)((()=>[(0,t.Uk)("新增")])),_:1},8,["icon"])):(0,t.kq)("",!0),e.hasAnyAuthority("system:person:delete")?((0,t.wg)(),(0,t.j4)(z,{key:1,title:"您确定要批量删除这些记录吗？",onConfirm:d[2]||(d[2]=e=>y(null))},{reference:(0,t.w5)((()=>[(0,t.Wm)(m,{type:"danger",icon:(0,o.SU)(n.Delete),disabled:p.value},{default:(0,t.w5)((()=>[(0,t.Uk)("批量删除")])),_:1},8,["icon","disabled"])])),_:1})):(0,t.kq)("",!0)])),_:1})])),_:1}),(0,t.Wm)(H,{style:{padding:"5px",background:"aliceblue"},id:"mainView"},{default:(0,t.w5)((()=>[(0,t.Wm)(D,{data:v.value,"max-height":g.value,"default-sort":{prop:"id",order:"ascending"},onSelectionChange:k,style:{width:"100%"},"highlight-current-row":"",stripe:""},{default:(0,t.w5)((()=>[(0,t.Wm)(C,{type:"selection",width:"40",align:"center"}),(0,t.Wm)(C,{prop:"id",label:"身份ID",width:"90","header-align":"center",sortable:"",fixed:""}),(0,t.Wm)(C,{prop:"name",label:"姓名",width:"94","header-align":"center",sortable:"",fixed:""}),(0,t.Wm)(C,{prop:"idNo",label:"身份证号",width:"170","header-align":"center",sortable:""}),(0,t.Wm)(C,{prop:"sex",label:"性别",width:"76",align:"center",sortable:""},{default:(0,t.w5)((({row:e})=>[(0,t.Wm)(A,{modelValue:e.sex,"onUpdate:modelValue":l=>e.sex=l,"inline-prompt":"",style:{"--el-switch-on-color":"#f89898","--el-switch-off-color":"#409EFF"},"active-icon":(0,o.SU)(n.Female),"inactive-icon":(0,o.SU)(n.Male),"active-value":!0,"inactive-value":!1,width:"50px",disabled:""},null,8,["modelValue","onUpdate:modelValue","active-icon","inactive-icon"])])),_:1}),(0,t.Wm)(C,{prop:"tel",label:"电话",width:"114",align:"center"}),(0,t.Wm)(C,{prop:"disabled",label:"状态",width:"76",align:"center",filters:[{text:"启用",value:!1},{text:"禁用",value:!0}],"filter-method":S},{default:(0,t.w5)((({row:l})=>[(0,t.Wm)(A,{modelValue:l.disabled,"onUpdate:modelValue":e=>l.disabled=e,"inline-prompt":"",style:{"--el-switch-on-color":"#13ce66","--el-switch-off-color":"#ff4949"},"active-text":"启用","inactive-text":"禁用","active-value":!1,"inactive-value":!0,width:"50px",loading:l.loading,onChange:e=>U(l),disabled:!e.hasAnyAuthority("system:person:edit")},null,8,["modelValue","onUpdate:modelValue","loading","onChange","disabled"])])),_:1}),(0,t.Wm)(C,{prop:"createTime",label:"创建时间",width:"160","header-align":"center",sortable:""}),(0,t.Wm)(C,{prop:"updateTime",label:"更新时间",width:"160","header-align":"center",sortable:""}),(0,t.Wm)(C,{prop:"note",label:"备注","min-width":"200","header-align":"center"}),(0,t.Wm)(C,{label:"操作",width:"130",align:"right","header-align":"center",fixed:"right"},{default:(0,t.w5)((l=>[e.hasAnyAuthority("system:person:edit")?((0,t.wg)(),(0,t.j4)(m,{key:0,type:"primary",icon:(0,o.SU)(n.Edit),onClick:e=>x(l.row.id)},null,8,["icon","onClick"])):(0,t.kq)("",!0),e.hasAnyAuthority("system:person:delete")?((0,t.wg)(),(0,t.j4)(z,{key:1,title:"您确定要删除这条记录吗？",onConfirm:e=>y(l.row.id)},{reference:(0,t.w5)((()=>[(0,t.Wm)(m,{type:"danger",icon:(0,o.SU)(n.Delete)},null,8,["icon"])])),_:2},1032,["onConfirm"])):(0,t.kq)("",!0)])),_:1})])),_:1},8,["data","max-height"])])),_:1}),(0,t.Wm)(N,{style:{background:"powderblue",height:"32px",display:"flex","align-items":"center","justify-content":"flex-end"}},{default:(0,t.w5)((()=>[(0,t.Wm)(j,{currentPage:l.currentPage,"onUpdate:currentPage":d[3]||(d[3]=e=>l.currentPage=e),"page-size":l.pageSize,"onUpdate:page-size":d[4]||(d[4]=e=>l.pageSize=e),"page-sizes":[10,15,20,50,100],small:"",background:"",layout:"total, sizes, prev, pager, next, jumper",total:s.value,onSizeChange:W,onCurrentChange:V},null,8,["currentPage","page-size","total"])])),_:1})])),_:1}),(0,t.Wm)((0,o.SU)(r["default"]),{"edit-dialog-visible":w.value,"onUpdate:edit-dialog-visible":d[5]||(d[5]=e=>w.value=e),id:h.value,title:f.value,onHandleSubmit:_},null,8,["edit-dialog-visible","id","title"])],64)}}}),g=a(89);const v=(0,g.Z)(m,[["__scopeId","data-v-03e644b2"]]);var w=v}}]);
//# sourceMappingURL=848.877b6422.js.map