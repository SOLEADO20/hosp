"use strict";(self["webpackChunkhosp"]=self["webpackChunkhosp"]||[]).push([[120],{2120:function(e,a,l){l.r(a),l.d(a,{default:function(){return c}});l(7658);var t=l(3396),d=l(4870),o=l(4901),r=l(7178),i=l(2655),u=l(2748);const s={class:"dialog-footer"},n={name:"EditDialog"};var m=Object.assign(n,{props:{editDialogVisible:{type:Boolean,required:!0,default:!1},editProps:{type:Object,required:!0,default:()=>({id:-1,date:new Date,time:0,departmentId:0})},title:{type:String,required:!0,default:""}},emits:["update:editDialogVisible","handleSubmit"],setup(e,{emit:a}){const l=e,n=(0,t.Fl)({get(){return l.editDialogVisible},set(e){a("update:editDialogVisible",e)}}),m=(0,d.iH)({id:-1,date:"",time:0,departmentId:0,roomId:"",workerId:"",capacity:25,disabled:!1}),p=(0,d.iH)([]),c=(0,d.iH)([]),g=(0,d.iH)([]),w=e=>{let a=e.getFullYear(),l=e.getMonth()+1,t=e.getDate(),d=a+"-"+(l<10?"0"+l:l)+"-"+(t<10?"0"+t:t);return console.log("dateToStr dateDate=",e,", dateStr=",d),d},b=e=>{let a=parseInt(e.substring(0,4)),l=parseInt(e.substring(5,7)),t=parseInt(e.substring(8,10)),d=new Date(a,l-1,t,0,0,0,0);return console.log("strToDate dateStr=",e,", dateDate=",d),d},v=async(e,a,l)=>{let t,d,r,i=w(m.value.date);switch(e.field){case"date":console.log("date=",a),d=0==m.value.time?8:14,r=new Date(a.getFullYear(),a.getMonth(),a.getDate(),d,0,0,0),r.getTime()<(new Date).getTime()?l(new Error("所选日期不得早于当前日期")):t="/api/bsns/schedules/checkSchedule?id="+m.value.id+"&date="+i+"&time="+m.value.time+"&workerId="+m.value.workerId;break;default:console.log("value=",a);break}if(t){let e=await o.ZP.post(t);1==e.data.code?l(new Error(e.data.msg)):l()}},f=(0,d.qj)({date:[{required:!0,message:"日期不能为空",trigger:"blur"},{validator:v,trigger:"change"},{validator:v,trigger:"blur"}],time:[{required:!0,message:"班次不能为空",trigger:"blur"}],roomId:[{required:!0,message:"诊室不能为空",trigger:"blur"}],workerId:[{required:!0,message:"值班人员不能为空",trigger:"blur"}],capacity:[{required:!0,message:"接纳人数不能为空",trigger:"blur"}],disabled:[{required:!0,message:"状态不能为空",trigger:"blur"}]}),h=(0,d.iH)(null),y=async e=>{if(-1==e.id)m.value={id:-1,date:e.date,time:e.time,departmentId:e.departmentId,roomId:"",workerId:"",capacity:25,disabled:!1},console.log("清空表单...");else{let a=await o.ZP.get("/api/bsns/schedules/"+e.id);if(console.log(a.data),20010==a.data.code){let e=a.data.schedule;e.date=b(e.date),m.value=e}else(0,r.z8)({message:a.data.msg,type:"error"});console.log("从后台填充...")}let a=await o.ZP.get("/api/bsns/departments");if(console.log(a.data),20010==a.data.code){let e=[];a.data.departmentList.forEach((a=>{a.name="+ "+a.name,e.push(a),a.children.forEach((a=>{a.name="••• "+a.name,e.push(a)}))})),p.value=e}else(0,r.z8)({message:a.data.msg,type:"error"}),p.value=[];let l=await o.ZP.get("/api/bsns/rooms/getByDepartmentId/"+m.value.departmentId);console.log(l.data),20010==l.data.code?c.value=l.data.roomList:((0,r.z8)({message:l.data.msg,type:"error"}),c.value=[]);let t=await o.ZP.get("/api/bsns/workers/getByDepartmentId/"+m.value.departmentId);console.log(t.data),20010==t.data.code?g.value=t.data.workerList:((0,r.z8)({message:t.data.msg,type:"error"}),g.value=[])},I=e=>{i.T.confirm("确认在未保存的情况下关闭对话框？").then((()=>{e()})).catch((()=>{}))},k=()=>{n.value=!1},V=()=>{h.value.validate((async e=>{if(e){let e,l,t=w(m.value.date),d={id:m.value.id,date:t,time:m.value.time,departmentId:m.value.departmentId,roomId:m.value.roomId,workerId:m.value.workerId,capacity:m.value.capacity,disabled:m.value.disabled};-1==m.value.id?(console.log("提交新增..."),e="/api/bsns/schedules",l=await o.ZP.post(e,d),console.log("新增排班 res.data= ",l.data)):(console.log("提交修改..."),e="/api/bsns/schedules",l=await o.ZP.put(e,d),console.log("修改排班 res.data= ",l.data)),20020==l.data.code||20030==l.data.code?((0,r.z8)({message:l.data.msg,type:"success"}),a("handleSubmit"),k()):(0,r.z8)({message:l.data.msg,type:"error"})}}))},D=async e=>{e=[e],console.log("删除...",e);let l="/api/bsns/schedules/"+e.join(",");console.log("url=",l);let t=await o.ZP.del(l);console.log("res=",t),20040==t.data.code?((0,r.z8)({message:t.data.msg,type:"success"}),a("handleSubmit"),k()):(0,r.z8)({message:t.data.msg,type:"error"})};return(0,t.YP)(n,(e=>{1==e&&y(l.editProps)})),(a,l)=>{const o=(0,t.up)("el-option"),r=(0,t.up)("el-select"),i=(0,t.up)("el-form-item"),w=(0,t.up)("el-date-picker"),b=(0,t.up)("el-radio"),v=(0,t.up)("el-radio-group"),W=(0,t.up)("el-input"),_=(0,t.up)("el-form"),P=(0,t.up)("el-button"),U=(0,t.up)("el-popconfirm"),q=(0,t.up)("el-dialog");return(0,t.wg)(),(0,t.j4)(q,{modelValue:(0,d.SU)(n),"onUpdate:modelValue":l[8]||(l[8]=e=>(0,d.dq)(n)?n.value=e:null),title:e.title,"before-close":I,width:"600px",draggable:""},{footer:(0,t.w5)((()=>[(0,t._)("span",s,[a.hasAnyAuthority("business:schedule:delete")&&-1!=e.editProps.id?((0,t.wg)(),(0,t.j4)(U,{key:0,title:"您确定要删除这条记录吗？",onConfirm:l[6]||(l[6]=a=>D(e.editProps.id))},{reference:(0,t.w5)((()=>[(0,t.Wm)(P,{type:"danger",icon:(0,d.SU)(u.Delete)},null,8,["icon"])])),_:1})):(0,t.kq)("",!0),(0,t.Wm)(P,{onClick:l[7]||(l[7]=a=>y(e.editProps))},{default:(0,t.w5)((()=>[(0,t.Uk)("重置")])),_:1}),(0,t.Wm)(P,{onClick:k},{default:(0,t.w5)((()=>[(0,t.Uk)("取消")])),_:1}),(0,t.Wm)(P,{type:"primary",onClick:V},{default:(0,t.w5)((()=>[(0,t.Uk)("确定")])),_:1})])])),default:(0,t.w5)((()=>[(0,t.Wm)(_,{ref_key:"editFormRef",ref:h,model:m.value,rules:f,inline:"","label-width":"80px","label-position":"right","status-icon":""},{default:(0,t.w5)((()=>[(0,t.Wm)(i,{label:"科室",prop:"departmentId",style:{width:"48%"}},{default:(0,t.w5)((()=>[(0,t.Wm)(r,{modelValue:m.value.departmentId,"onUpdate:modelValue":l[0]||(l[0]=e=>m.value.departmentId=e),placeholder:"请选择科室",disabled:""},{default:(0,t.w5)((()=>[(0,t.Wm)(o,{label:"顶级科室",value:0}),((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)(p.value,(e=>((0,t.wg)(),(0,t.j4)(o,{key:e.id,label:e.name,value:e.id},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),(0,t.Wm)(i,{label:"诊室",prop:"roomId",style:{width:"40%"}},{default:(0,t.w5)((()=>[(0,t.Wm)(r,{modelValue:m.value.roomId,"onUpdate:modelValue":l[1]||(l[1]=e=>m.value.roomId=e),placeholder:"请选择诊室"},{default:(0,t.w5)((()=>[((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)(c.value,(e=>((0,t.wg)(),(0,t.j4)(o,{key:e.id,label:e.roomNo+" . "+e.note,value:e.id},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),(0,t.Wm)(i,{label:"日期",prop:"date",style:{width:"48%"}},{default:(0,t.w5)((()=>[(0,t.Wm)(w,{modelValue:m.value.date,"onUpdate:modelValue":l[2]||(l[2]=e=>m.value.date=e),type:"date",placeholder:"选择日期",clearable:!1},null,8,["modelValue"])])),_:1}),(0,t.Wm)(i,{label:"班次",prop:"time",style:{width:"40%"}},{default:(0,t.w5)((()=>[(0,t.Wm)(v,{modelValue:m.value.time,"onUpdate:modelValue":l[3]||(l[3]=e=>m.value.time=e)},{default:(0,t.w5)((()=>[(0,t.Wm)(b,{label:0,size:"large"},{default:(0,t.w5)((()=>[(0,t.Uk)("上午")])),_:1}),(0,t.Wm)(b,{label:1,size:"large"},{default:(0,t.w5)((()=>[(0,t.Uk)("下午")])),_:1})])),_:1},8,["modelValue"])])),_:1}),(0,t.Wm)(i,{label:"值班人员",prop:"workerId",style:{width:"100%"}},{default:(0,t.w5)((()=>[(0,t.Wm)(r,{modelValue:m.value.workerId,"onUpdate:modelValue":l[4]||(l[4]=e=>m.value.workerId=e),filterable:"","default-first-option":"",placeholder:"搜索人员",style:{width:"100%"}},{default:(0,t.w5)((()=>[((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)(g.value,(e=>((0,t.wg)(),(0,t.j4)(o,{key:e.id,label:e.doctorInfo.name+" . "+("0"==e.doctorInfo.sex?"男":"女")+" . "+e.doctorInfo.tel+" . "+e.doctorInfo.idNo,value:e.id},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),(0,t.Wm)(i,{label:"接纳人数",prop:"capacity",style:{width:"48%"}},{default:(0,t.w5)((()=>[(0,t.Wm)(W,{modelValue:m.value.capacity,"onUpdate:modelValue":l[5]||(l[5]=e=>m.value.capacity=e),type:"number"},null,8,["modelValue"])])),_:1})])),_:1},8,["model","rules"])])),_:1},8,["modelValue","title"])}}});const p=m;var c=p}}]);
//# sourceMappingURL=120.09a0a483.js.map