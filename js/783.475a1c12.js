"use strict";(self["webpackChunkhosp"]=self["webpackChunkhosp"]||[]).push([[783],{3783:function(e,l,a){a.r(l),a.d(l,{default:function(){return f}});var t=a(3396),r=a(4870),o=a(4901),s=a(7178),i=a(2655),d=a(4239);const u=["src"],n={class:"dialog-footer"},p={name:"EditDialog"};var m=Object.assign(p,{props:{editDialogVisible:{type:Boolean,required:!0,default:!1},id:{type:Number,required:!0,default:-1}},emits:["update:editDialogVisible","handleSubmit"],setup(e,{emit:l}){const a=e,p=(0,t.Fl)({get(){return a.editDialogVisible},set(e){l("update:editDialogVisible",e)}}),m=(0,r.iH)({id:-1,profile:"",username:"",password:"",rePassword:"",disabled:!1,note:"",personInfo:{name:"",idNo:"",tel:void 0,sex:!1,disabled:!1}}),g=(0,r.iH)({token:d.Z.getters.GET_TOKEN}),c=async(e,l,a)=>{let t;if("username"==e.field)l&&l.length>16?a(new Error("用户名长度不可超过16位")):t="/api/center/users/checkUser?id="+m.value.id+"&username="+l;else if("personInfo.tel"==e.field){let e=/^(13[0-9]|14[01456879]|15[0-35-9]|16[2567]|17[0-8]|18[0-9]|19[0-35-9])\d{8}$/;e.test(l)?t="/api/center/users/checkUser?id="+m.value.id+"&tel="+l:a(new Error("请输入正确的手机号"))}if(t){let e=await o.ZP.post(t);1==e.data.code?a(new Error(e.data.msg)):a()}},f=(0,r.qj)({username:[{required:!0,message:"用户名不能为空",trigger:"blur"},{validator:c,trigger:"change"},{validator:c,trigger:"blur"}],"personInfo.tel":[{required:!0,message:"手机号不能为空",trigger:"blur"},{validator:c,trigger:"change"},{validator:c,trigger:"blur"}],note:[{required:!1,max:192,message:"备注信息不可超过192个字符",trigger:"blur"}]}),w=(0,r.iH)(null),v=(e,l)=>{console.log("uploadFile=",l),console.log("res=",e),0==e.code?m.value.profile=e.newFileName:(0,s.z8)({message:e.msg,type:"error"})},b=e=>(console.log("rawFile=",e),"image/jpeg"!==e.type&&"image/png"!==e.type?(s.z8.error("图片格式必须为 JPG 或 PNG 格式！"),!1):!(e.size/1024>500)||(s.z8.error("文件大小不能超过 500KB！"),!1)),h=async e=>{let l=await o.ZP.get("/api/center/users/"+e);if(console.log(l.data),20010==l.data.code){let e=l.data.user;m.value=e}else(0,s.z8)({message:l.data.msg,type:"error"});console.log("从后台填充...")},y=e=>{i.T.confirm("确认在未保存的情况下关闭对话框？").then((()=>{e()})).catch((()=>{}))},V=()=>{p.value=!1},_=()=>{w.value.validate((async e=>{if(e){let e,a;console.log("提交修改..."),e="/api/center/users",a=await o.ZP.put(e,m.value),console.log("修改用户 res.data= ",a.data),20020==a.data.code||20030==a.data.code?((0,s.z8)({message:a.data.msg,type:"success"}),l("handleSubmit"),V()):(0,s.z8)({message:a.data.msg,type:"error"})}}))};return(0,t.YP)(p,(e=>{1==e&&h(a.id)})),(l,a)=>{const s=(0,t.up)("el-upload"),i=(0,t.up)("el-form-item"),d=(0,t.up)("el-input"),c=(0,t.up)("el-form"),k=(0,t.up)("el-button"),U=(0,t.up)("el-dialog");return(0,t.wg)(),(0,t.j4)(U,{modelValue:(0,r.SU)(p),"onUpdate:modelValue":a[4]||(a[4]=e=>(0,r.dq)(p)?p.value=e:null),title:"编辑用户信息","before-close":y,width:"600px",draggable:""},{footer:(0,t.w5)((()=>[(0,t._)("span",n,[(0,t.Wm)(k,{onClick:a[3]||(a[3]=l=>h(e.id))},{default:(0,t.w5)((()=>[(0,t.Uk)("重置")])),_:1}),(0,t.Wm)(k,{onClick:V},{default:(0,t.w5)((()=>[(0,t.Uk)("取消")])),_:1}),(0,t.Wm)(k,{type:"primary",onClick:_},{default:(0,t.w5)((()=>[(0,t.Uk)("确定")])),_:1})])])),default:(0,t.w5)((()=>[(0,t.Wm)(c,{ref_key:"editFormRef",ref:w,model:m.value,rules:f,inline:"","label-width":"80px","label-position":"right","status-icon":""},{default:(0,t.w5)((()=>[(0,t.Wm)(i,{label:"头像",prop:"profile",style:{width:"48%"}},{default:(0,t.w5)((()=>[(0,t.Wm)(s,{class:"avatar-uploader",headers:g.value,action:(0,r.SU)(o.RU)()+"/api/center/users/uploadProfile","show-file-list":!1,"on-success":v,"before-upload":b},{default:(0,t.w5)((()=>[(0,t._)("img",{src:(0,r.SU)(o.RU)()+"/image/userProfile/"+m.value.profile,class:"avatar"},null,8,u)])),_:1},8,["headers","action"])])),_:1}),(0,t.Wm)(i,{label:"用户名",prop:"username",style:{width:"48%"}},{default:(0,t.w5)((()=>[(0,t.Wm)(d,{modelValue:m.value.username,"onUpdate:modelValue":a[0]||(a[0]=e=>m.value.username=e)},null,8,["modelValue"])])),_:1}),(0,t.Wm)(i,{label:"电话",prop:"personInfo.tel",style:{width:"40%"}},{default:(0,t.w5)((()=>[(0,t.Wm)(d,{modelValue:m.value.personInfo.tel,"onUpdate:modelValue":a[1]||(a[1]=e=>m.value.personInfo.tel=e)},null,8,["modelValue"])])),_:1}),(0,t.Wm)(i,{label:"备注",prop:"note",style:{width:"100%"}},{default:(0,t.w5)((()=>[(0,t.Wm)(d,{modelValue:m.value.note,"onUpdate:modelValue":a[2]||(a[2]=e=>m.value.note=e),type:"textarea",rows:5},null,8,["modelValue"])])),_:1})])),_:1},8,["model","rules"])])),_:1},8,["modelValue"])}}}),g=a(89);const c=(0,g.Z)(m,[["__scopeId","data-v-bf29f8d0"]]);var f=c}}]);
//# sourceMappingURL=783.475a1c12.js.map