"use strict";(self["webpackChunkhosp"]=self["webpackChunkhosp"]||[]).push([[419],{7419:function(e,l,t){t.r(l),t.d(l,{default:function(){return M}});var o=t(3396),s=t(4870),a=t(9242),r=t(4901),u=t(1931),n=t(680),i=t(7178),d=t(2748),m=t(3527),p=t(5410),c=t.n(p),g=t(4239),_=t(1120),w=t(9847);const f=e=>((0,o.dD)("data-v-df837000"),e=e(),(0,o.Cn)(),e),y={class:"loginPage"},h=f((()=>(0,o._)("h3",{class:"formTitle"},"科旺医院 门诊服务",-1))),v={class:"securityCodeWrapper"},b=["src"],x={id:"demoResource"},U=f((()=>(0,o._)("span",null,"示例账号资源：",-1))),Z=f((()=>(0,o._)("table",{cellspacing:"0"},[(0,o._)("tr",null,[(0,o._)("th",{style:{width:"90px"}},"账号"),(0,o._)("th",{style:{width:"70px"}},"密码"),(0,o._)("th",{style:{width:"200px"}},"描述")]),(0,o._)("tr",null,[(0,o._)("td",null,"guest-sys"),(0,o._)("td",null,"202209"),(0,o._)("td",null,"系统数据维护员（只读）")]),(0,o._)("tr",null,[(0,o._)("td",null,"guest-bsns"),(0,o._)("td",null,"202209"),(0,o._)("td",null,"医院数据维护员（只读）")]),(0,o._)("tr",null,[(0,o._)("td",null,"guest-doct"),(0,o._)("td",null,"202406"),(0,o._)("td",null,"医生（只读，可处理订单）")]),(0,o._)("tr",null,[(0,o._)("td",null,"guest"),(0,o._)("td",null,"202406"),(0,o._)("td",null,"普通用户（只读）")])],-1))),C={name:"Login"};var W=Object.assign(C,{setup(e){const l=(0,s.qj)({username:"",password:"",securityCode:"",rememberMe:!1,uuid:""});let t=(0,s.iH)("");const p=(0,s.qj)({username:[{required:!0,message:"请输入您的账号",trigger:"blur"}],password:[{required:!0,message:"请输入您的密码",trigger:"blur"}],securityCode:[{required:!0,message:"请输入验证码",trigger:"change"}]}),f=async()=>{let e=await r.ZP.get("/captcha");console.log("captcha res= ",e),l.uuid=e.data.uuid,l.securityCode="",t.value=e.data.base64Img},C=(0,s.iH)(null),W=(0,s.iH)(!1),k=()=>{console.log("login!"),console.log("loginFormRef.value= ",C.value),C.value.validate((async e=>{if(console.log("valid= ",e),e){console.log("表单验证通过"),l.rememberMe?(console.log("记住密码"),n.Z.set("username",l.username,{expires:7}),n.Z.set("password",(0,m.H)(l.password,{expires:7})),n.Z.set("rememberMe",l.rememberMe,{expires:7})):(console.log("不记住密码"),n.Z.remove("username"),n.Z.remove("password"),n.Z.remove("rememberMe"));try{let e=await r.ZP.post("login",c().stringify(l));if(200==e.data.code){console.log("res.data= ",e.data);const l=e.data.authorization,t=e.data.menuList,o=e.data.perms,s=e.data.currentUser;g.Z.commit("SET_TOKEN",l),g.Z.commit("SET_MENULIST",t),g.Z.commit("SET_PERMS",o),g.Z.commit("SET_USERINFO",s),_.Z.replace({path:"/"}),(0,i.z8)({message:"登录成功.",type:"success"})}else(0,i.z8)({showClose:!0,message:e.data.msg,type:"error"}),await f()}catch(t){console.log("login e= ",t),(0,i.z8)({showClose:!0,message:"哎呀呀~出错了嚯！\n"+t,type:"error"}),await f()}}else console.log("表单验证不通过"),(0,i.z8)({message:"请将信息填写完整",type:"warning"})}))},S=()=>{console.log("register!"),W.value=!0},M=()=>{const e=n.Z.get("username"),t=n.Z.get("password"),o=n.Z.get("rememberMe");l.username=void 0==e?l.username:e,l.password=void 0==t?l.password:(0,m.p)(t),l.rememberMe=void 0==o?l.rememberMe:o};return f(),M(),(e,r)=>{const n=(0,o.up)("el-input"),i=(0,o.up)("el-form-item"),m=(0,o.up)("el-checkbox"),c=(0,o.up)("el-button"),g=(0,o.up)("el-form");return(0,o.wg)(),(0,o.iD)(o.HY,null,[(0,o._)("div",y,[(0,o.Wm)(g,{model:l,rules:p,ref_key:"loginFormRef",ref:C,class:"loginForm"},{default:(0,o.w5)((()=>[h,(0,o.Wm)(i,{prop:"username"},{default:(0,o.w5)((()=>[(0,o.Wm)(n,{modelValue:l.username,"onUpdate:modelValue":r[0]||(r[0]=e=>l.username=e),type:"text",size:"large",autocomplete:"off",placeholder:"用户名 / 手机号 / 身份证号","prefix-icon":(0,s.SU)(d.User)},null,8,["modelValue","prefix-icon"])])),_:1}),(0,o.Wm)(i,{prop:"password"},{default:(0,o.w5)((()=>[(0,o.Wm)(n,{modelValue:l.password,"onUpdate:modelValue":r[1]||(r[1]=e=>l.password=e),type:"password",size:"large",autocomplete:"off",placeholder:"密码","prefix-icon":(0,s.SU)(d.Lock),onKeyup:(0,a.D2)(k,["enter"]),"show-password":""},null,8,["modelValue","prefix-icon","onKeyup"])])),_:1}),(0,o.Wm)(i,{prop:"securityCode"},{default:(0,o.w5)((()=>[(0,o.Wm)(n,{modelValue:l.securityCode,"onUpdate:modelValue":r[2]||(r[2]=e=>l.securityCode=e),type:"text",size:"large",autocomplete:"off",placeholder:"验证码","prefix-icon":(0,s.SU)(d.CircleCheck),onKeyup:(0,a.D2)(k,["enter"]),style:{width:"67%"}},null,8,["modelValue","prefix-icon","onKeyup"]),(0,o._)("div",v,[(0,o._)("img",{src:(0,s.SU)(t),onClick:f,alt:"刷新验证码"},null,8,b)])])),_:1}),(0,o.Wm)(i,null,{default:(0,o.w5)((()=>[(0,o.Wm)(m,{label:"记住密码",modelValue:l.rememberMe,"onUpdate:modelValue":r[3]||(r[3]=e=>l.rememberMe=e)},null,8,["modelValue"])])),_:1}),(0,o.Wm)(i,{style:{width:"100%"}},{default:(0,o.w5)((()=>[(0,o.Wm)(c,{type:"primary",size:"small",onClick:S,style:{width:"auto",margin:"auto","letter-spacing":"1px"},text:""},{default:(0,o.w5)((()=>[(0,o.Uk)(">>注 册<< ")])),_:1})])),_:1}),(0,o.Wm)(i,null,{default:(0,o.w5)((()=>[(0,o.Wm)(c,{type:"primary",size:"large",onClick:k,style:{width:"100%"}},{default:(0,o.w5)((()=>[(0,o.Uk)("登 录")])),_:1})])),_:1})])),_:1},8,["model","rules"]),(0,o._)("div",x,[U,(0,o.Wm)(c,{type:"danger",size:"small",plain:"",style:{position:"absolute",right:"10px"},onclick:"document.getElementById('demoResource').style.display='none'"},{default:(0,o.w5)((()=>[(0,o.Uk)("x ")])),_:1}),Z]),(0,o.Wm)((0,s.SU)(u.Z),{class:"loginPageFooter"})]),(0,o.Wm)((0,s.SU)(w["default"]),{"register-dialog-visible":W.value,"onUpdate:register-dialog-visible":r[4]||(r[4]=e=>W.value=e)},null,8,["register-dialog-visible"])],64)}}}),k=t(89);const S=(0,k.Z)(W,[["__scopeId","data-v-df837000"]]);var M=S}}]);
//# sourceMappingURL=419.030ed642.js.map