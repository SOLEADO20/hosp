"use strict";(self["webpackChunkhosp"]=self["webpackChunkhosp"]||[]).push([[49,294],{3819:function(e,l,t){t.d(l,{Z:function(){return r}});var a=t(3396),d=t(7139);function n(e,l,t,n,o,u){const i=(0,a.up)("el-icon"),r=(0,a.up)("el-menu-item"),s=(0,a.up)("el-sub-menu"),c=(0,a.up)("el-menu"),m=(0,a.up)("el-scrollbar");return(0,a.wg)(),(0,a.j4)(m,null,{default:(0,a.w5)((()=>[(0,a.Wm)(c,null,{default:(0,a.w5)((()=>[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(t.menuData,(l=>((0,a.wg)(),(0,a.iD)(a.HY,{key:l.path+l.name},[void 0!=l.children&&l.children.length>0?((0,a.wg)(),(0,a.j4)(s,{key:0,index:l.path+l.name},{title:(0,a.w5)((()=>[(0,a.Wm)(i,null,{default:(0,a.w5)((()=>[""!=l.icon?((0,a.wg)(),(0,a.j4)((0,a.LL)(l.icon),{key:0})):(0,a.kq)("",!0)])),_:2},1024),(0,a.Uk)(" "+(0,d.zw)(l.name),1)])),default:(0,a.w5)((()=>[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(l.children,(t=>((0,a.wg)(),(0,a.j4)(r,{key:t.path+t.name,index:t.path+t.name,onClick:a=>e.$emit("selectMenu",l,t)},{title:(0,a.w5)((()=>[(0,a.Wm)(i,null,{default:(0,a.w5)((()=>[""!=t.icon?((0,a.wg)(),(0,a.j4)((0,a.LL)(t.icon),{key:0})):(0,a.kq)("",!0)])),_:2},1024),(0,a.Uk)(" "+(0,d.zw)(t.name),1)])),_:2},1032,["index","onClick"])))),128))])),_:2},1032,["index"])):((0,a.wg)(),(0,a.j4)(r,{key:1,index:l.path+l.name,onClick:t=>e.$emit("selectMenu",l)},{title:(0,a.w5)((()=>[(0,a.Wm)(i,null,{default:(0,a.w5)((()=>[""!=l.icon?((0,a.wg)(),(0,a.j4)((0,a.LL)(l.icon),{key:0})):(0,a.kq)("",!0)])),_:2},1024),(0,a.Uk)(" "+(0,d.zw)(l.name),1)])),_:2},1032,["index","onClick"]))],64)))),128))])),_:1})])),_:1})}var o={name:"Menu",props:["menuData"]},u=t(89);const i=(0,u.Z)(o,[["render",n]]);var r=i},5294:function(e,l,t){t.r(l),t.d(l,{default:function(){return k}});t(541);var a=t(3396),d=t(4870),n=t(7139),o=t(4901),u=t(7178),i=t(4239);const r={class:"cell-item"},s={class:"cell-item"},c={class:"cell-item"},m={class:"cell-item"},p={class:"cell-item"},w={style:{flex:"auto"}},f={name:"EditDrawer"};var g=Object.assign(f,{props:{editDrawerVisible:{type:Boolean,required:!0,default:!1},scheduleInfo:{type:Object,required:!0,default:()=>({id:6,date:"2022-11-08T16:00:00.000Z",time:0,departmentId:17,roomId:20,workerId:14,capacity:24,departmentInfo:{name:"体检科",id:17},roomInfo:{id:20,disabled:!1,deleted:!1,roomNo:205,departmentId:17,note:"体检科诊室",departmentInfo:null},doctorInfo:{id:15,name:"付玉琳",idNo:null,sex:!0,tel:17788889997,note:"擅长健康检查"}})}},emits:["update:editDrawerVisible","handleSubmit"],setup(e,{emit:l}){const t=e,f=(0,a.Fl)({get(){return t.editDrawerVisible},set(e){l("update:editDrawerVisible",e)}}),g=(0,d.iH)(i.Z.getters.GET_USERINFO),_=(0,d.iH)([]),h=(0,d.iH)({id:-1,patientId:-1,scheduleId:t.scheduleInfo.id,userId:g.value.id}),k=(0,d.qj)({patientId:[{required:!0,message:"请选择就诊人",trigger:"blur"}]}),I=(0,d.iH)(null),v=async()=>{let e=await o.ZP.get("/api/center/users/"+g.value.id),l=await o.ZP.get("/api/center/patients?userId="+g.value.id);if(console.log("更新用户信息 res= ",e),console.log("更新就诊人信息 res= ",l),20010==e.data.code&&20010==l.data.code){let a=e.data.user.personInfo,d={id:-1,userId:e.data.user.id,patientId:a.id,relation:"本人",note:"无",patientInfo:a};_.value=l.data.patientList,_.value.unshift(d),h.value={id:-1,patientId:a.id,scheduleId:t.scheduleInfo.id,userId:g.value.id}}else(0,u.z8)({message:e.data.msg,type:"error"})},W=()=>{f.value=!1},b=()=>{I.value.validate((async e=>{if(e){let e,t;console.log("提交新增..."),e="/api/center/appointments",t=await o.ZP.post(e,h.value),console.log("新增预约 res.data= ",t.data),20020==t.data.code?((0,u.z8)({message:t.data.msg,type:"success"}),l("handleSubmit"),W()):(0,u.z8)({message:t.data.msg,type:"error"})}}))};return(0,a.YP)(f,(e=>{1==e&&v()})),(l,t)=>{const o=(0,a.up)("InfoFilled"),u=(0,a.up)("el-icon"),i=(0,a.up)("el-descriptions-item"),g=(0,a.up)("QuestionFilled"),v=(0,a.up)("Iphone"),D=(0,a.up)("EditPen"),U=(0,a.up)("el-descriptions"),y=(0,a.up)("el-radio"),z=(0,a.up)("el-radio-group"),x=(0,a.up)("el-form-item"),V=(0,a.up)("el-form"),H=(0,a.up)("el-button"),C=(0,a.up)("el-drawer");return(0,a.wg)(),(0,a.j4)(C,{modelValue:(0,d.SU)(f),"onUpdate:modelValue":t[1]||(t[1]=e=>(0,d.dq)(f)?f.value=e:null),direction:"rtl"},{header:(0,a.w5)((()=>[(0,a._)("h4",null,"预约 "+(0,n.zw)(e.scheduleInfo.departmentInfo.name)+" "+(0,n.zw)(e.scheduleInfo.doctorInfo.name)+"医生",1)])),default:(0,a.w5)((()=>[(0,a.Wm)(U,{title:"医生信息卡",column:2,size:"default",border:""},{default:(0,a.w5)((()=>[(0,a.Wm)(i,null,{label:(0,a.w5)((()=>[(0,a._)("div",r,[(0,a.Wm)(u,null,{default:(0,a.w5)((()=>[(0,a.Wm)(o)])),_:1}),(0,a.Uk)(" 工号 ")])])),default:(0,a.w5)((()=>[(0,a.Uk)(" "+(0,n.zw)(e.scheduleInfo.workerId),1)])),_:1}),(0,a.Wm)(i,null,{label:(0,a.w5)((()=>[(0,a._)("div",s,[(0,a.Wm)(u,null,{default:(0,a.w5)((()=>[(0,a.Wm)(o)])),_:1}),(0,a.Uk)(" 姓名 ")])])),default:(0,a.w5)((()=>[(0,a.Uk)(" "+(0,n.zw)(e.scheduleInfo.doctorInfo.name),1)])),_:1}),(0,a.Wm)(i,null,{label:(0,a.w5)((()=>[(0,a._)("div",c,[(0,a.Wm)(u,null,{default:(0,a.w5)((()=>[(0,a.Wm)(g)])),_:1}),(0,a.Uk)(" 性别 ")])])),default:(0,a.w5)((()=>[(0,a.Uk)(" "+(0,n.zw)("0"==e.scheduleInfo.doctorInfo.sex?"男":"女"),1)])),_:1}),(0,a.Wm)(i,null,{label:(0,a.w5)((()=>[(0,a._)("div",m,[(0,a.Wm)(u,null,{default:(0,a.w5)((()=>[(0,a.Wm)(v)])),_:1}),(0,a.Uk)(" 电话 ")])])),default:(0,a.w5)((()=>[(0,a.Uk)(" "+(0,n.zw)(e.scheduleInfo.doctorInfo.tel),1)])),_:1}),(0,a.Wm)(i,null,{label:(0,a.w5)((()=>[(0,a._)("div",p,[(0,a.Wm)(u,null,{default:(0,a.w5)((()=>[(0,a.Wm)(D)])),_:1}),(0,a.Uk)(" 特长 ")])])),default:(0,a.w5)((()=>[(0,a.Uk)(" "+(0,n.zw)(e.scheduleInfo.doctorInfo.note),1)])),_:1})])),_:1})])),footer:(0,a.w5)((()=>[(0,a.Wm)(V,{ref_key:"editFormRef",ref:I,model:h.value,rules:k,"label-width":"100px","label-position":"right",style:{"margin-bottom":"25%"}},{default:(0,a.w5)((()=>[(0,a.Wm)(x,{label:"选择就诊人",prop:"patientId"},{default:(0,a.w5)((()=>[(0,a.Wm)(z,{modelValue:h.value.patientId,"onUpdate:modelValue":t[0]||(t[0]=e=>h.value.patientId=e)},{default:(0,a.w5)((()=>[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(_.value,(e=>((0,a.wg)(),(0,a.j4)(y,{key:e.patientId,label:e.patientId},{default:(0,a.w5)((()=>[(0,a.Uk)((0,n.zw)(e.relation)+" "+(0,n.zw)(e.patientInfo.name),1)])),_:2},1032,["label"])))),128))])),_:1},8,["modelValue"])])),_:1})])),_:1},8,["model","rules"]),(0,a._)("div",w,[(0,a.Wm)(H,{onClick:W},{default:(0,a.w5)((()=>[(0,a.Uk)("取消")])),_:1}),(0,a.Wm)(H,{type:"primary",onClick:b},{default:(0,a.w5)((()=>[(0,a.Uk)("预约")])),_:1})])])),_:1},8,["modelValue"])}}}),_=t(89);const h=(0,_.Z)(g,[["__scopeId","data-v-34e27b16"]]);var k=h},5049:function(e,l,t){t.r(l),t.d(l,{default:function(){return D}});t(7658);var a=t(3396),d=t(4870),n=t(7139),o=t(4901),u=t(5410),i=t.n(u),r=t(7178),s=t(3819),c=t(5294);const m=e=>((0,a.dD)("data-v-2357ce72"),e=e(),(0,a.Cn)(),e),p=m((()=>(0,a._)("span",null,null,-1))),w={class:"card-header"},f={class:"cell-item"},g={class:"cell-item"},_={class:"cell-item"},h={class:"cell-item"},k={class:"cell-item"},I={name:"index"};var v=Object.assign(I,{setup(e){let l=(0,d.iH)([]),t=(0,d.iH)([{id:998,date:new Date(2022,10,1,0,0,0,0),time:0,departmentId:0,roomId:10075286712,workerId:9980,capacity:20,disabled:!1,departmentInfo:{id:0,name:"顶级科室"},roomInfo:{roomNo:103,disabled:!1},doctorInfo:{name:"欧阳修米",idNo:"430111200012310089",tel:18877776666,sex:!0}}]);const u=(0,d.iH)([]),m=(0,d.qj)({departmentId:0,weekViewEnabled:!0,selectedDate:new Date}),I=(0,d.iH)({id:-1,name:"",note:""}),v=(0,d.iH)(1),W=(0,d.iH)([new Date(m.selectedDate.getTime()-864e5*m.selectedDate.getDay()),new Date(m.selectedDate.getTime()+864e5*(6-m.selectedDate.getDay()))]),b=(0,d.iH)(),D=(0,d.iH)(!1),U=(0,d.iH)({id:6,date:"2022-11-08T16:00:00.000Z",time:0,departmentId:17,roomId:20,workerId:14,capacity:24,departmentInfo:{name:"体检科",id:17},roomInfo:{id:20,disabled:!1,deleted:!1,roomNo:205,departmentId:17,note:"体检科诊室",departmentInfo:null},doctorInfo:{id:15,name:"付玉琳",idNo:null,sex:!0,tel:17788889997,note:"擅长健康检查"}}),y=()=>{m.selectedDate=new Date(m.selectedDate.getTime()-6048e5)},z=()=>{m.selectedDate=new Date(m.selectedDate.getTime()+6048e5)},x=e=>{b.value.selectDate(e)},V=(e,l)=>{console.log("选择科室",e,l),l?(m.departmentId=l.path,I.value=l):(m.departmentId=e.path,I.value=e)},H=(e,l)=>{m.selectedDate=e,v.value=l},C=e=>{console.log("新增...",e),U.value=e,D.value=!0},j=(e,l)=>{let a=e.getFullYear(),d=e.getMonth(),n=e.getDate(),o=[];for(const u of t.value)u.date.getFullYear()!=a||u.date.getMonth()!=d||u.date.getDate()!=n||null!=l&&u.time!=l||o.push(u);return o},S=e=>{let l=e.getFullYear(),t=e.getMonth()+1,a=e.getDate(),d=l+"-"+(t<10?"0"+t:t)+"-"+(a<10?"0"+a:a);return console.log("dateToStr dateDate=",e,", dateStr=",d),d},Z=e=>{let l=parseInt(e.substring(0,4)),t=parseInt(e.substring(5,7)),a=parseInt(e.substring(8,10)),d=new Date(l,t-1,a,0,0,0,0);return console.log("strToDate dateStr=",e,", dateDate=",d),d},q=async()=>{let e=S(m.selectedDate),a={departmentId:m.departmentId,weekViewEnabled:m.weekViewEnabled,selectedDate:e},d="/api/bsns/schedules?"+i().stringify(a);console.log("url=",d);let n=await o.ZP.get(d);if(console.log("更新排班列表 res= ",n),20010==n.data.code){let e=[];n.data.scheduleList.forEach((l=>{l.date=Z(l.date),e.push(l)})),t.value=e}else(0,r.z8)({message:n.data.msg,type:"error"});let u=await o.ZP.get("/api/bsns/departments");if(console.log(u.data),20010==u.data.code){let e=[];u.data.departmentList.forEach((l=>{let t={name:l.name,path:l.id,note:l.note,children:[]};l.children.forEach((e=>{let l={name:e.name,path:e.id,note:e.note,children:[]};t.children.push(l)})),e.push(t)})),l.value=e}};q();const E=()=>{console.log()};return(0,a.YP)(m,((e,l)=>{if(console.log("watch queryForm.selectedDate=",e.selectedDate),m.weekViewEnabled){let l=new Date(e.selectedDate.getTime()-864e5*e.selectedDate.getDay()),t=new Date(e.selectedDate.getTime()+864e5*(6-e.selectedDate.getDay()));W.value=[l,t]}else W.value=null;console.log(Date.now()+" 重新拉取数据..."),console.log(m),q(),u.value=j(e.selectedDate,v.value)}),{deep:!0}),(e,t)=>{const i=(0,a.up)("el-aside"),r=(0,a.up)("el-date-picker"),Z=(0,a.up)("el-row"),q=(0,a.up)("el-button"),F=(0,a.up)("el-popover"),T=(0,a.up)("el-header"),Y=(0,a.up)("el-button-group"),P=(0,a.up)("el-badge"),L=(0,a.up)("el-calendar"),M=(0,a.up)("el-divider"),N=(0,a.up)("el-avatar"),K=(0,a.up)("InfoFilled"),O=(0,a.up)("el-icon"),R=(0,a.up)("el-descriptions-item"),A=(0,a.up)("QuestionFilled"),Q=(0,a.up)("Iphone"),$=(0,a.up)("EditPen"),B=(0,a.up)("el-descriptions"),G=(0,a.up)("el-card"),J=(0,a.up)("el-scrollbar"),X=(0,a.up)("el-main"),ee=(0,a.up)("el-container");return(0,a.wg)(),(0,a.iD)(a.HY,null,[(0,a.Wm)(i,{width:"250px"},{default:(0,a.w5)((()=>[(0,a.Wm)((0,d.SU)(s.Z),{"menu-data":(0,d.SU)(l),onSelectMenu:V},null,8,["menu-data"])])),_:1}),(0,a.Wm)(ee,null,{default:(0,a.w5)((()=>[(0,a.Wm)(T,{class:"operatingFloor"},{default:(0,a.w5)((()=>[(0,a.Wm)(Z,{gutter:20},{default:(0,a.w5)((()=>[(0,a.Wm)(r,{modelValue:m.selectedDate,"onUpdate:modelValue":t[0]||(t[0]=e=>m.selectedDate=e),type:"week",format:"[第] ww [周]",placeholder:"选择一周",clearable:!1,style:{margin:"0 10px"},disabled:""},null,8,["modelValue"])])),_:1}),(0,a.Wm)(F,{placement:"bottom",title:I.value.name,width:500,trigger:"hover",content:I.value.note},{reference:(0,a.w5)((()=>[(0,a.Wm)(q,{style:{"margin-left":"12px"}},{default:(0,a.w5)((()=>[(0,a.Uk)((0,n.zw)(I.value.name)+"介绍",1)])),_:1})])),_:1},8,["title","content"])])),_:1}),(0,a.Wm)(X,{style:{padding:"5px",background:"aliceblue"},id:"mainView"},{default:(0,a.w5)((()=>[(0,a.Wm)(J,null,{default:(0,a.w5)((()=>[(0,a.Wm)(L,{modelValue:m.selectedDate,"onUpdate:modelValue":t[2]||(t[2]=e=>m.selectedDate=e),range:W.value,ref_key:"calendar",ref:b},{header:(0,a.w5)((({date:e})=>[(0,a._)("span",null,(0,n.zw)(e),1),p,(0,a.Wm)(Y,null,{default:(0,a.w5)((()=>[(0,a.Wm)(q,{size:"small",onClick:y},{default:(0,a.w5)((()=>[(0,a.Uk)("上一周")])),_:1}),(0,a.Wm)(q,{size:"small",onClick:t[1]||(t[1]=e=>x("today"))},{default:(0,a.w5)((()=>[(0,a.Uk)("今天")])),_:1}),(0,a.Wm)(q,{size:"small",onClick:z},{default:(0,a.w5)((()=>[(0,a.Uk)("下一周")])),_:1})])),_:1})])),"date-cell":(0,a.w5)((({data:e})=>[(0,a._)("p",{class:(0,n.C_)(e.isSelected?"is-selected":"")},(0,n.zw)(e.day.split("-").slice(1).join("-")),3),(0,a.Wm)(P,{value:j(e.date,0).length,hidden:j(e.date,0).length<1},{default:(0,a.w5)((()=>[(0,a.Wm)(q,{onClick:l=>H(e.date,0)},{default:(0,a.w5)((()=>[(0,a.Uk)("查看上午")])),_:2},1032,["onClick"])])),_:2},1032,["value","hidden"]),(0,a.Wm)(P,{value:j(e.date,1).length,hidden:j(e.date,1).length<1},{default:(0,a.w5)((()=>[(0,a.Wm)(q,{onClick:l=>H(e.date,1)},{default:(0,a.w5)((()=>[(0,a.Uk)("查看下午")])),_:2},1032,["onClick"])])),_:2},1032,["value","hidden"])])),_:1},8,["modelValue","range"]),(0,a.Wm)(M,null,{default:(0,a.w5)((()=>[(0,a.Uk)((0,n.zw)(S(m.selectedDate))+" "+(0,n.zw)(0==v.value?"上午":"下午")+" 的排班信息",1)])),_:1}),((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(u.value,(l=>((0,a.wg)(),(0,a.j4)(G,{key:l.id,style:{"margin-top":"20px","margin-left":"12px",width:"600px",float:"left"}},{header:(0,a.w5)((()=>[(0,a._)("div",w,[(0,a._)("div",null,[(0,a.Wm)(N,{shape:"square",size:"default",src:(0,d.SU)(o.RU)()+"/image/userProfile/"+l.profile},null,8,["src"]),(0,a._)("span",null," "+(0,n.zw)(l.departmentInfo.name)+" · 排班信息卡",1)]),e.hasAnyAuthority("center:appointment:add")?((0,a.wg)(),(0,a.j4)(q,{key:0,type:"warning",onClick:e=>C(l)},{default:(0,a.w5)((()=>[(0,a.Uk)(" 预约 ")])),_:2},1032,["onClick"])):(0,a.kq)("",!0)])])),default:(0,a.w5)((()=>[(0,a.Wm)(B,{column:4,size:"default",border:""},{default:(0,a.w5)((()=>[(0,a.Wm)(R,null,{label:(0,a.w5)((()=>[(0,a._)("div",f,[(0,a.Wm)(O,null,{default:(0,a.w5)((()=>[(0,a.Wm)(K)])),_:1}),(0,a.Uk)(" 工号 ")])])),default:(0,a.w5)((()=>[(0,a.Uk)(" "+(0,n.zw)(l.workerId),1)])),_:2},1024),(0,a.Wm)(R,{width:"68px"},{label:(0,a.w5)((()=>[(0,a._)("div",g,[(0,a.Wm)(O,null,{default:(0,a.w5)((()=>[(0,a.Wm)(K)])),_:1}),(0,a.Uk)(" 姓名 ")])])),default:(0,a.w5)((()=>[(0,a.Uk)(" "+(0,n.zw)(l.doctorInfo.name),1)])),_:2},1024),(0,a.Wm)(R,{width:"38px"},{label:(0,a.w5)((()=>[(0,a._)("div",_,[(0,a.Wm)(O,null,{default:(0,a.w5)((()=>[(0,a.Wm)(A)])),_:1}),(0,a.Uk)(" 性别 ")])])),default:(0,a.w5)((()=>[(0,a.Uk)(" "+(0,n.zw)("0"==l.doctorInfo.sex?"男":"女"),1)])),_:2},1024),(0,a.Wm)(R,{width:"68px"},{label:(0,a.w5)((()=>[(0,a._)("div",h,[(0,a.Wm)(O,null,{default:(0,a.w5)((()=>[(0,a.Wm)(Q)])),_:1}),(0,a.Uk)(" 电话 ")])])),default:(0,a.w5)((()=>[(0,a.Uk)(" "+(0,n.zw)(l.doctorInfo.tel),1)])),_:2},1024),(0,a.Wm)(R,{width:"68px"},{label:(0,a.w5)((()=>[(0,a._)("div",k,[(0,a.Wm)(O,null,{default:(0,a.w5)((()=>[(0,a.Wm)($)])),_:1}),(0,a.Uk)(" 特长 ")])])),default:(0,a.w5)((()=>[(0,a.Uk)(" "+(0,n.zw)(l.doctorInfo.note),1)])),_:2},1024)])),_:2},1024)])),_:2},1024)))),128))])),_:1})])),_:1})])),_:1}),(0,a.Wm)((0,d.SU)(c["default"]),{"schedule-info":U.value,"edit-drawer-visible":D.value,"onUpdate:edit-drawer-visible":t[3]||(t[3]=e=>D.value=e),onHandleSubmit:E},null,8,["schedule-info","edit-drawer-visible"])],64)}}}),W=t(89);const b=(0,W.Z)(v,[["__scopeId","data-v-2357ce72"]]);var D=b}}]);
//# sourceMappingURL=49.e21b163b.js.map