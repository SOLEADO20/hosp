"use strict";(self["webpackChunkhosp"]=self["webpackChunkhosp"]||[]).push([[866,549,722],{3549:function(e,a,l){l.r(a),l.d(a,{default:function(){return g}});var t=l(3396),o=l(4870),i=l(4901),n=l(7178),d=l(2655);const r={class:"dialog-footer"},s={name:"EditDialog"};var u=Object.assign(s,{props:{editDialogVisible:{type:Boolean,required:!0,default:!1},id:{type:Number,required:!0,default:-1},title:{type:String,required:!0,default:""}},emits:["update:editDialogVisible","handleSubmit"],setup(e,{emit:a}){const l=e,s=(0,t.Fl)({get(){return l.editDialogVisible},set(e){a("update:editDialogVisible",e)}}),u=(0,o.iH)({id:-1,name:"",code:"",disabled:!1,note:""}),c=async(e,a,l)=>{let t;if("name"==e.field?a&&a.length>16?l(new Error("角色名称长度不可超过16位")):t="/api/sys/roles/checkRole?id="+u.value.id+"&name="+a:"code"==e.field&&(a&&a.length>16?l(new Error("角色代号长度不可超过16位")):t="/api/sys/roles/checkRole?id="+u.value.id+"&code="+a),t){let e=await i.ZP.post(t);1==e.data.code?l(new Error(e.data.msg)):l()}},g=(0,o.qj)({name:[{required:!0,message:"角色名称不能为空",trigger:"blur"},{validator:c,trigger:"change"},{validator:c,trigger:"blur"}],code:[{required:!0,message:"角色代号不能为空",trigger:"blur"},{validator:c,trigger:"change"},{validator:c,trigger:"blur"}],disabled:[{required:!0,message:"状态不能为空",trigger:"blur"}],note:[{required:!1,max:192,message:"备注信息不可超过192个字符",trigger:"blur"}]}),m=(0,o.iH)(null),p=async e=>{if(-1==e)u.value={id:-1,name:"",code:"",disabled:!1,note:""},console.log("清空表单...");else{let a=await i.ZP.get("/api/sys/roles/"+e);if(console.log(a.data),20010==a.data.code){let e=a.data.role;u.value=e}else(0,n.z8)({message:a.data.msg,type:"error"});console.log("从后台填充...")}},y=e=>{d.T.confirm("确认在未保存的情况下关闭对话框？").then((()=>{e()})).catch((()=>{}))},f=()=>{s.value=!1},h=()=>{m.value.validate((async e=>{if(e){let e,l;-1==u.value.id?(console.log("提交新增..."),e="/api/sys/roles",l=await i.ZP.post(e,u.value),console.log("新增角色 res.data= ",l.data)):(console.log("提交修改..."),e="/api/sys/roles",l=await i.ZP.put(e,u.value),console.log("修改角色 res.data= ",l.data)),20020==l.data.code||20030==l.data.code?((0,n.z8)({message:l.data.msg,type:"success"}),a("handleSubmit"),f()):(0,n.z8)({message:l.data.msg,type:"error"})}}))};return(0,t.YP)(s,(e=>{1==e&&p(l.id)})),(a,l)=>{const i=(0,t.up)("el-input"),n=(0,t.up)("el-form-item"),d=(0,t.up)("el-switch"),c=(0,t.up)("el-form"),w=(0,t.up)("el-button"),b=(0,t.up)("el-dialog");return(0,t.wg)(),(0,t.j4)(b,{modelValue:(0,o.SU)(s),"onUpdate:modelValue":l[5]||(l[5]=e=>(0,o.dq)(s)?s.value=e:null),title:e.title,"before-close":y,width:"600px",draggable:""},{footer:(0,t.w5)((()=>[(0,t._)("span",r,[(0,t.Wm)(w,{onClick:l[4]||(l[4]=a=>p(e.id))},{default:(0,t.w5)((()=>[(0,t.Uk)("重置")])),_:1}),(0,t.Wm)(w,{onClick:f},{default:(0,t.w5)((()=>[(0,t.Uk)("取消")])),_:1}),(0,t.Wm)(w,{type:"primary",onClick:h},{default:(0,t.w5)((()=>[(0,t.Uk)("确定")])),_:1})])])),default:(0,t.w5)((()=>[(0,t.Wm)(c,{ref_key:"editFormRef",ref:m,model:u.value,rules:g,inline:"","label-width":"80px","label-position":"right","status-icon":""},{default:(0,t.w5)((()=>[(0,t.Wm)(n,{label:"角色名称",prop:"name",style:{width:"48%"}},{default:(0,t.w5)((()=>[(0,t.Wm)(i,{modelValue:u.value.name,"onUpdate:modelValue":l[0]||(l[0]=e=>u.value.name=e)},null,8,["modelValue"])])),_:1}),(0,t.Wm)(n,{label:"角色代号",prop:"code",style:{width:"40%"}},{default:(0,t.w5)((()=>[(0,t.Wm)(i,{modelValue:u.value.code,"onUpdate:modelValue":l[1]||(l[1]=e=>u.value.code=e)},null,8,["modelValue"])])),_:1}),(0,t.Wm)(n,{label:"状态",prop:"disabled",style:{width:"40%"}},{default:(0,t.w5)((()=>[(0,t.Wm)(d,{modelValue:u.value.disabled,"onUpdate:modelValue":l[2]||(l[2]=e=>u.value.disabled=e),style:{"--el-switch-on-color":"#13ce66","--el-switch-off-color":"#ff4949"},"active-text":"启用","inactive-text":"禁用","active-value":!1,"inactive-value":!0,width:"50px"},null,8,["modelValue"])])),_:1}),(0,t.Wm)(n,{label:"备注",prop:"note",style:{width:"100%"}},{default:(0,t.w5)((()=>[(0,t.Wm)(i,{modelValue:u.value.note,"onUpdate:modelValue":l[3]||(l[3]=e=>u.value.note=e),type:"textarea",rows:5},null,8,["modelValue"])])),_:1})])),_:1},8,["model","rules"])])),_:1},8,["modelValue","title"])}}});const c=u;var g=c},8722:function(e,a,l){l.r(a),l.d(a,{default:function(){return g}});l(7658);var t=l(3396),o=l(4870),i=l(4901),n=l(7178),d=l(2655);const r={class:"dialog-footer"},s={name:"GrantMenuDialog"};var u=Object.assign(s,{props:{grantMenuDialogVisible:{type:Boolean,required:!0,default:!1},id:{type:Number,required:!0,default:-1}},emits:["update:grantMenuDialogVisible","handleSubmit"],setup(e,{emit:a}){const l=e,s=(0,t.Fl)({get(){return l.grantMenuDialogVisible},set(e){a("update:grantMenuDialogVisible",e)}}),u=(0,o.iH)({id:-1}),c={label:"name",children:"children"},g=(0,o.iH)([]),m=(0,o.iH)(null),p=(e,a,l)=>{},y=async e=>{try{let a=await i.ZP.get("/api/sys/menus"),l=await i.ZP.get("/api/sys/roles/"+e);if(console.log(a.data),console.log(l.data),20010==a.data.code&&20010==l.data.code){g.value=a.data.menuListTree;let e=[];l.data.role.menuList.forEach((a=>{e.push(a.id)})),m.value.setCheckedKeys(e),u.value=l.data.role}else(0,n.z8)({message:a.data.msg,type:"error"}),(0,n.z8)({message:l.data.msg,type:"error"});console.log("从后台填充...")}catch(a){console.log("e=",a)}},f=e=>{d.T.confirm("确认在未保存的情况下关闭对话框？").then((()=>{e()})).catch((()=>{}))},h=()=>{s.value=!1},w=async()=>{let e,l;console.log("提交权限分配..."),e="/api/sys/roles/grantMenu/"+u.value.id;try{l=await i.ZP.put(e,m.value.getCheckedKeys()),console.log("分配给角色权限菜单 res.data= ",l.data),20030==l.data.code?((0,n.z8)({message:l.data.msg,type:"success"}),a("handleSubmit"),h()):(0,n.z8)({message:l.data.msg,type:"error"})}catch(t){console.log("e=",t),(0,n.z8)({message:"操作失败！"+t,type:"error"})}};return(0,t.YP)(s,(e=>{1==e&&y(l.id)})),(a,l)=>{const i=(0,t.up)("el-tree"),n=(0,t.up)("el-form-item"),d=(0,t.up)("el-form"),b=(0,t.up)("el-button"),v=(0,t.up)("el-dialog");return(0,t.wg)(),(0,t.j4)(v,{modelValue:(0,o.SU)(s),"onUpdate:modelValue":l[1]||(l[1]=e=>(0,o.dq)(s)?s.value=e:null),title:"分配权限","before-close":f,width:"30%",draggable:""},{footer:(0,t.w5)((()=>[(0,t._)("span",r,[(0,t.Wm)(b,{onClick:l[0]||(l[0]=a=>y(e.id))},{default:(0,t.w5)((()=>[(0,t.Uk)("重置")])),_:1}),(0,t.Wm)(b,{onClick:h},{default:(0,t.w5)((()=>[(0,t.Uk)("取消")])),_:1}),(0,t.Wm)(b,{type:"primary",onClick:w},{default:(0,t.w5)((()=>[(0,t.Uk)("确定")])),_:1})])])),default:(0,t.w5)((()=>[(0,t.Wm)(d,{model:u.value},{default:(0,t.w5)((()=>[(0,t.Wm)(n,null,{default:(0,t.w5)((()=>[(0,t.Wm)(i,{props:c,data:g.value,ref_key:"treeRef",ref:m,"node-key":"id","show-checkbox":"","default-expand-all":"","check-strictly":"",onCheckChange:p},null,8,["data"])])),_:1})])),_:1},8,["model"])])),_:1},8,["modelValue"])}}});const c=u;var g=c},9866:function(e,a,l){l.r(a),l.d(a,{default:function(){return w}});l(7658);var t=l(3396),o=l(9242),i=l(4870),n=l(7139),d=l(2748),r=l(4901),s=l(3549),u=l(8722),c=l(5410),g=l.n(c),m=l(7178);const p={name:"index"};var y=Object.assign(p,{setup(e){const a=(0,i.qj)({query:"",currentPage:1,pageSize:10}),l=(0,i.iH)(""),c=(0,i.iH)(40),p=(0,i.iH)(!0),y=(0,i.iH)([]),f=(0,i.iH)(400),h=(0,i.iH)(!1),w=(0,i.iH)([{id:10075286712,name:"超级管理员",code:"su",note:"拥有最高权限",menuList:[{id:1,name:"用户管理"},{id:6,name:"角色管理"},{id:7,name:"权限管理"}],disabled:!1,createTime:"2022-09-23 20:10:01",updateTime:"2022-10-18 18:16:18"},{id:1007448077,name:"管理员1",code:"admin1",note:"拥有部分高级权限",menuList:[{id:1,name:"用户管理"},{id:6,name:"角色管理"},{id:7,name:"权限管理"}],disabled:!1,createTime:"2022-09-23 20:10:01",updateTime:"2022-10-18 18:16:18"}]),b=(0,i.iH)(!1),v=(0,i.iH)(!1),k=(0,i.iH)(-1),W=(0,i.iH)(""),V=()=>{a.currentPage=1,a.query==l.value?(console.log("手动刷新：关键字不变..."),H()):a.query=l.value},_=async e=>{e?e=[e]:(e=[],y.value.forEach((a=>{e.push(a.id)}))),console.log("删除...",e);let a="/api/sys/roles/"+e.join(",");console.log("url=",a);let l=await r.ZP.del(a);console.log("res=",l),20040==l.data.code?((0,m.z8)({message:l.data.msg,type:"success"}),await H()):(0,m.z8)({message:l.data.msg,type:"error"})},z=e=>{console.log("分配角色...",e),k.value=e,v.value=!0},U=e=>{e?(console.log("修改...",e),k.value=e,W.value="角色修改"):(console.log("新增...",e),k.value=-1,W.value="角色添加"),b.value=!0},S=e=>{console.log(`${e} items per page`)},x=e=>{console.log(`current page: ${e}`)},C=e=>{y.value=e,p.value=0==e.length,console.log("新选择= ",e)},P=async e=>{e.loading=!0;let a="/api/sys/roles/updateDisabled/"+e.id+"/"+e.disabled;try{let l=await r.ZP.put(a);20030==l.data.code?(0,m.z8)({message:l.data.msg,type:"success"}):((0,m.z8)({message:l.data.msg,type:"error"}),e.disabled=!e.disabled)}catch(l){console.log("e=",l),(0,m.z8)({message:"操作失败！"+l,type:"error"}),e.disabled=!e.disabled}e.loading=!1},q=(e,a)=>a.disabled===e,H=async()=>{let e="/api/sys/roles?"+g().stringify(a);console.log("url=",e);let l=await r.ZP.get(e);if(console.log("更新角色列表 res= ",l),20010==l.data.code){let e=l.data.roleList;e.forEach((e=>{let a=[];e.menuList.forEach((e=>{h.value?"F"==e.type&&a.push(e):"M"==e.type&&a.push(e)})),e.menuList=a})),w.value=e,c.value=l.data.total}else(0,m.z8)({message:l.data.msg,type:"error"})};H(),(0,t.YP)(a,(async(e,l)=>{if(e.pageSize!=l.pageSize){let a=l.pageSize*(l.currentPage-1)+1;e.currentPage=Math.ceil(a/e.pageSize)}console.log(Date.now()+" 重新拉取数据..."),console.log(a),await H()}));const D=new ResizeObserver((e=>{for(const a of e)if("mainView"==a.target.id){let e;if(a.contentBoxSize){const l=Array.isArray(a.contentBoxSize)?a.contentBoxSize[0]:a.contentBoxSize;e=l.blockSize}else e=a.contentRect.height;f.value=e}}));return(0,t.bv)((()=>{const e=document.getElementById("mainView");D.observe(e)})),(e,r)=>{const g=(0,t.up)("el-input"),m=(0,t.up)("el-col"),y=(0,t.up)("el-button"),D=(0,t.up)("el-popconfirm"),j=(0,t.up)("el-checkbox"),A=(0,t.up)("el-row"),Z=(0,t.up)("el-header"),E=(0,t.up)("el-table-column"),T=(0,t.up)("el-switch"),L=(0,t.up)("el-tag"),M=(0,t.up)("el-table"),B=(0,t.up)("el-main"),R=(0,t.up)("el-pagination"),F=(0,t.up)("el-footer"),K=(0,t.up)("el-container");return(0,t.wg)(),(0,t.iD)(t.HY,null,[(0,t.Wm)(K,null,{default:(0,t.w5)((()=>[(0,t.Wm)(Z,{class:"operatingFloor"},{default:(0,t.w5)((()=>[(0,t.Wm)(A,{gutter:20},{default:(0,t.w5)((()=>[(0,t.Wm)(m,{span:7},{default:(0,t.w5)((()=>[(0,t.Wm)(g,{modelValue:l.value,"onUpdate:modelValue":r[0]||(r[0]=e=>l.value=e),placeholder:"搜索角色...",onKeyup:(0,o.D2)(V,["enter"]),clearable:""},null,8,["modelValue","onKeyup"])])),_:1}),(0,t.Wm)(y,{type:"primary",icon:(0,i.SU)(d.Search),onClick:V},{default:(0,t.w5)((()=>[(0,t.Uk)("查询")])),_:1},8,["icon"]),e.hasAnyAuthority("system:role:add")?((0,t.wg)(),(0,t.j4)(y,{key:0,type:"success",icon:(0,i.SU)(d.DocumentAdd),onClick:r[1]||(r[1]=e=>U(null))},{default:(0,t.w5)((()=>[(0,t.Uk)("新增")])),_:1},8,["icon"])):(0,t.kq)("",!0),e.hasAnyAuthority("system:role:delete")?((0,t.wg)(),(0,t.j4)(D,{key:1,title:"您确定要批量删除这些记录吗？",onConfirm:r[2]||(r[2]=e=>_(null))},{reference:(0,t.w5)((()=>[(0,t.Wm)(y,{type:"danger",icon:(0,i.SU)(d.Delete),disabled:p.value},{default:(0,t.w5)((()=>[(0,t.Uk)("批量删除")])),_:1},8,["icon","disabled"])])),_:1})):(0,t.kq)("",!0),(0,t.Wm)(j,{label:"切换菜单预览为父级",modelValue:h.value,"onUpdate:modelValue":r[3]||(r[3]=e=>h.value=e),onChange:H,style:{"margin-left":"12px"}},null,8,["modelValue"])])),_:1})])),_:1}),(0,t.Wm)(B,{style:{padding:"5px",background:"aliceblue"},id:"mainView"},{default:(0,t.w5)((()=>[(0,t.Wm)(M,{data:w.value,"max-height":f.value,"default-sort":{prop:"id",order:"ascending"},onSelectionChange:C,style:{width:"100%"},"highlight-current-row":"",stripe:""},{default:(0,t.w5)((()=>[(0,t.Wm)(E,{type:"selection",width:"40",align:"center"}),(0,t.Wm)(E,{prop:"id",label:"角色ID",width:"90","header-align":"center",sortable:"",fixed:""}),(0,t.Wm)(E,{prop:"name",label:"角色名称",width:"120","header-align":"center",sortable:"",fixed:""}),(0,t.Wm)(E,{prop:"code",label:"角色代号",width:"100","header-align":"center"}),(0,t.Wm)(E,{prop:"disabled",label:"状态",width:"76",align:"center",filters:[{text:"启用",value:!1},{text:"禁用",value:!0}],"filter-method":q},{default:(0,t.w5)((({row:a})=>[(0,t.Wm)(T,{modelValue:a.disabled,"onUpdate:modelValue":e=>a.disabled=e,"inline-prompt":"",style:{"--el-switch-on-color":"#13ce66","--el-switch-off-color":"#ff4949"},"active-text":"启用","inactive-text":"禁用","active-value":!1,"inactive-value":!0,width:"50px",loading:a.loading,onChange:e=>P(a),disabled:!e.hasAnyAuthority("system:role:edit")},null,8,["modelValue","onUpdate:modelValue","loading","onChange","disabled"])])),_:1}),(0,t.Wm)(E,{prop:"createTime",label:"创建时间",width:"160","header-align":"center",sortable:""}),(0,t.Wm)(E,{prop:"updateTime",label:"更新时间",width:"160","header-align":"center",sortable:""}),(0,t.Wm)(E,{prop:"note",label:"备注",width:"200","header-align":"center"}),(0,t.Wm)(E,{prop:"menuList",label:"菜单预览","min-width":"400",align:"center"},{default:(0,t.w5)((e=>[((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)(e.row.menuList,(e=>((0,t.wg)(),(0,t.j4)(L,{type:"warning",size:"small",key:e.id},{default:(0,t.w5)((()=>[(0,t.Uk)((0,n.zw)(e.name),1)])),_:2},1024)))),128))])),_:1}),(0,t.Wm)(E,{label:"操作",width:"250",align:"right","header-align":"center",fixed:"right"},{default:(0,t.w5)((a=>[e.hasAnyAuthority("system:role:edit")?((0,t.wg)(),(0,t.j4)(y,{key:0,type:"primary",icon:(0,i.SU)(d.Tools),onClick:e=>z(a.row.id)},{default:(0,t.w5)((()=>[(0,t.Uk)("分配权限")])),_:2},1032,["icon","onClick"])):(0,t.kq)("",!0),e.hasAnyAuthority("system:role:edit")?((0,t.wg)(),(0,t.j4)(y,{key:1,type:"primary",icon:(0,i.SU)(d.Edit),onClick:e=>U(a.row.id)},null,8,["icon","onClick"])):(0,t.kq)("",!0),e.hasAnyAuthority("system:role:delete")?((0,t.wg)(),(0,t.j4)(D,{key:2,title:"您确定要删除这条记录吗？",onConfirm:e=>_(a.row.id)},{reference:(0,t.w5)((()=>[(0,t.Wm)(y,{type:"danger",icon:(0,i.SU)(d.Delete)},null,8,["icon"])])),_:2},1032,["onConfirm"])):(0,t.kq)("",!0)])),_:1})])),_:1},8,["data","max-height"])])),_:1}),(0,t.Wm)(F,{style:{background:"powderblue",height:"32px",display:"flex","align-items":"center","justify-content":"flex-end"}},{default:(0,t.w5)((()=>[(0,t.Wm)(R,{currentPage:a.currentPage,"onUpdate:currentPage":r[4]||(r[4]=e=>a.currentPage=e),"page-size":a.pageSize,"onUpdate:page-size":r[5]||(r[5]=e=>a.pageSize=e),"page-sizes":[5,10,20,50,100],small:"",background:"",layout:"total, sizes, prev, pager, next, jumper",total:c.value,onSizeChange:S,onCurrentChange:x},null,8,["currentPage","page-size","total"])])),_:1})])),_:1}),(0,t.Wm)((0,i.SU)(s["default"]),{"edit-dialog-visible":b.value,"onUpdate:edit-dialog-visible":r[6]||(r[6]=e=>b.value=e),id:k.value,title:W.value,onHandleSubmit:H},null,8,["edit-dialog-visible","id","title"]),(0,t.Wm)((0,i.SU)(u["default"]),{"grant-menu-dialog-visible":v.value,"onUpdate:grant-menu-dialog-visible":r[7]||(r[7]=e=>v.value=e),id:k.value,onHandleSubmit:H},null,8,["grant-menu-dialog-visible","id"])],64)}}}),f=l(89);const h=(0,f.Z)(y,[["__scopeId","data-v-452a2bf6"]]);var w=h}}]);
//# sourceMappingURL=866.dadc856d.js.map