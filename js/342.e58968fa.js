"use strict";(self["webpackChunkhosp"]=self["webpackChunkhosp"]||[]).push([[342],{6342:function(e,o,l){l.r(o),l.d(o,{default:function(){return x}});var a=l(3396),r=l(4870),s=l(9242),t=l(4901),i=l(128),u=l(680),m=l(7178),n=l(2748),d=l(3527),c=l(5410),p=l.n(c),g=l(4239),f=l(1120),w=l(9847);const y=e=>((0,a.dD)("data-v-48ce5af7"),e=e(),(0,a.Cn)(),e),v={class:"loginPage"},h=y((()=>(0,a._)("h3",{class:"formTitle"},"科王飙医院 门诊服务",-1))),b={class:"securityCodeWrapper"},_=["src"],Z={name:"Login"};var C=Object.assign(Z,{setup(e){const o=(0,r.qj)({username:"",password:"",securityCode:"",rememberMe:!1,uuid:""});let l=(0,r.iH)("");const c=(0,r.qj)({username:[{required:!0,message:"请输入您的账号",trigger:"blur"}],password:[{required:!0,message:"请输入您的密码",trigger:"blur"}],securityCode:[{required:!0,message:"请输入验证码",trigger:"change"}]}),y=async()=>{let e=await t.ZP.get("/captcha");console.log("captcha res= ",e),o.uuid=e.data.uuid,o.securityCode="",l.value=e.data.base64Img},Z=(0,r.iH)(null),C=(0,r.iH)(!1),U=()=>{console.log("login!"),console.log("loginFormRef.value= ",Z.value),Z.value.validate((async e=>{if(console.log("valid= ",e),e){console.log("表单验证通过"),o.rememberMe?(console.log("记住密码"),u.Z.set("username",o.username,{expires:7}),u.Z.set("password",(0,d.H)(o.password,{expires:7})),u.Z.set("rememberMe",o.rememberMe,{expires:7})):(console.log("不记住密码"),u.Z.remove("username"),u.Z.remove("password"),u.Z.remove("rememberMe")),console.log("stringify loginForm=",p().stringify(o));try{let e=await t.ZP.post("login?"+p().stringify(o));if(200==e.data.code){console.log("res.data= ",e.data);const o=e.data.authorization,l=e.data.menuList,a=e.data.perms,r=e.data.currentUser;g.Z.commit("SET_TOKEN",o),g.Z.commit("SET_MENULIST",l),g.Z.commit("SET_PERMS",a),g.Z.commit("SET_USERINFO",r),f.Z.replace({path:"/"}),(0,m.z8)({message:"登录成功.",type:"success"})}else(0,m.z8)({showClose:!0,message:e.data.msg,type:"error"}),await y()}catch(l){console.log("login e= ",l),(0,m.z8)({showClose:!0,message:"哎呀呀~出错了嚯！\n"+l,type:"error"}),await y()}}else console.log("表单验证不通过"),(0,m.z8)({message:"请将信息填写完整",type:"warning"})}))},W=()=>{console.log("register!"),C.value=!0},x=()=>{const e=u.Z.get("username"),l=u.Z.get("password"),a=u.Z.get("rememberMe");o.username=void 0==e?o.username:e,o.password=void 0==l?o.password:(0,d.p)(l),o.rememberMe=void 0==a?o.rememberMe:a};return y(),x(),(e,t)=>{const u=(0,a.up)("el-input"),m=(0,a.up)("el-form-item"),d=(0,a.up)("el-checkbox"),p=(0,a.up)("el-button"),g=(0,a.up)("el-form");return(0,a.wg)(),(0,a.iD)(a.HY,null,[(0,a._)("div",v,[(0,a.Wm)(g,{model:o,rules:c,ref_key:"loginFormRef",ref:Z,class:"loginForm"},{default:(0,a.w5)((()=>[h,(0,a.Wm)(m,{prop:"username"},{default:(0,a.w5)((()=>[(0,a.Wm)(u,{modelValue:o.username,"onUpdate:modelValue":t[0]||(t[0]=e=>o.username=e),type:"text",size:"large",autocomplete:"off",placeholder:"用户名 / 手机号 / 身份证号","prefix-icon":(0,r.SU)(n.User)},null,8,["modelValue","prefix-icon"])])),_:1}),(0,a.Wm)(m,{prop:"password"},{default:(0,a.w5)((()=>[(0,a.Wm)(u,{modelValue:o.password,"onUpdate:modelValue":t[1]||(t[1]=e=>o.password=e),type:"password",size:"large",autocomplete:"off",placeholder:"密码","prefix-icon":(0,r.SU)(n.Lock),onKeyup:(0,s.D2)(U,["enter"]),"show-password":""},null,8,["modelValue","prefix-icon","onKeyup"])])),_:1}),(0,a.Wm)(m,{prop:"securityCode"},{default:(0,a.w5)((()=>[(0,a.Wm)(u,{modelValue:o.securityCode,"onUpdate:modelValue":t[2]||(t[2]=e=>o.securityCode=e),type:"text",size:"large",autocomplete:"off",placeholder:"验证码","prefix-icon":(0,r.SU)(n.CircleCheck),onKeyup:(0,s.D2)(U,["enter"]),style:{width:"67%"}},null,8,["modelValue","prefix-icon","onKeyup"]),(0,a._)("div",b,[(0,a._)("img",{src:(0,r.SU)(l),onClick:y,alt:"刷新验证码"},null,8,_)])])),_:1}),(0,a.Wm)(m,null,{default:(0,a.w5)((()=>[(0,a.Wm)(d,{label:"记住密码",modelValue:o.rememberMe,"onUpdate:modelValue":t[3]||(t[3]=e=>o.rememberMe=e)},null,8,["modelValue"])])),_:1}),(0,a.Wm)(m,{style:{width:"100%"}},{default:(0,a.w5)((()=>[(0,a.Wm)(p,{type:"primary",size:"small",onClick:W,style:{width:"auto",margin:"auto","letter-spacing":"1px"},text:""},{default:(0,a.w5)((()=>[(0,a.Uk)(">>注 册<< ")])),_:1})])),_:1}),(0,a.Wm)(m,null,{default:(0,a.w5)((()=>[(0,a.Wm)(p,{type:"primary",size:"large",onClick:U,style:{width:"100%"}},{default:(0,a.w5)((()=>[(0,a.Uk)("登 录")])),_:1})])),_:1})])),_:1},8,["model","rules"]),(0,a.Wm)((0,r.SU)(i.Z),{class:"loginPageFooter"})]),(0,a.Wm)((0,r.SU)(w["default"]),{"register-dialog-visible":C.value,"onUpdate:register-dialog-visible":t[4]||(t[4]=e=>C.value=e)},null,8,["register-dialog-visible"])],64)}}}),U=l(89);const W=(0,U.Z)(C,[["__scopeId","data-v-48ce5af7"]]);var x=W}}]);
//# sourceMappingURL=342.e58968fa.js.map