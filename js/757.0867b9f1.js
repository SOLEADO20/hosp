"use strict";(self["webpackChunkhosp"]=self["webpackChunkhosp"]||[]).push([[757],{7757:function(e,l,a){a.r(l),a.d(l,{default:function(){return m}});a(7658);var t=a(3396),o=a(4870),s=a(7139),d=a(4901),u=a(7178),i=a(2655);a(5410);const r={class:"dialog-footer"},n={name:"GrantRoleDialog"};var c=Object.assign(n,{props:{grantRoleDialogVisible:{type:Boolean,required:!0,default:!1},id:{type:Number,required:!0,default:-1}},emits:["update:grantRoleDialogVisible","handleSubmit"],setup(e,{emit:l}){const a=e,n=(0,t.Fl)({get(){return a.grantRoleDialogVisible},set(e){l("update:grantRoleDialogVisible",e)}}),c=(0,o.iH)({id:-1,roleList:[],roleIdList:[],checkedRoleIdList:[]}),g=(0,o.iH)(!1),m=(0,o.iH)(!0),p=async e=>{try{let l=await d.ZP.get("/api/sys/roles"),a=await d.ZP.get("/api/sys/users/"+e);if(console.log(l.data),console.log(a.data),20010==l.data.code&&20010==a.data.code){let t=l.data.roleList,o=[];t.forEach((e=>{o.push(e.id)}));let s=[];a.data.user.roleList.forEach((e=>{s.push(e.id)})),c.value.id=e,c.value.roleList=t,c.value.roleIdList=o,c.value.checkedRoleIdList=s,h(s)}else(0,u.z8)({message:l.data.msg,type:"error"}),(0,u.z8)({message:a.data.msg,type:"error"});console.log("从后台填充...")}catch(l){console.log("e=",l)}},h=e=>{console.log(e);let l=e.length;g.value=l===c.value.roleIdList.length,m.value=l>0&&l<c.value.roleIdList.length},f=e=>{c.value.checkedRoleIdList=e?c.value.roleIdList:[],m.value=!1},v=e=>{i.T.confirm("确认在未保存的情况下关闭对话框？").then((()=>{e()})).catch((()=>{}))},k=()=>{n.value=!1},w=async()=>{let e,a;console.log("提交角色分配..."),e="/api/sys/users/grantRole/"+c.value.id;try{a=await d.ZP.put(e,c.value.checkedRoleIdList),console.log("分配用户角色 res.data= ",a.data),20030==a.data.code?((0,u.z8)({message:a.data.msg,type:"success"}),l("handleSubmit"),k()):(0,u.z8)({message:a.data.msg,type:"error"})}catch(t){console.log("e=",t),(0,u.z8)({message:"操作失败！"+t,type:"error"})}};return(0,t.YP)(n,(e=>{1==e&&p(a.id)})),(l,a)=>{const d=(0,t.up)("el-checkbox"),u=(0,t.up)("el-form-item"),i=(0,t.up)("el-checkbox-group"),b=(0,t.up)("el-form"),y=(0,t.up)("el-button"),L=(0,t.up)("el-dialog");return(0,t.wg)(),(0,t.j4)(L,{modelValue:(0,o.SU)(n),"onUpdate:modelValue":a[3]||(a[3]=e=>(0,o.dq)(n)?n.value=e:null),title:"分配角色","before-close":v,width:"600px",draggable:""},{footer:(0,t.w5)((()=>[(0,t._)("span",r,[(0,t.Wm)(y,{onClick:a[2]||(a[2]=l=>p(e.id))},{default:(0,t.w5)((()=>[(0,t.Uk)("重置")])),_:1}),(0,t.Wm)(y,{onClick:k},{default:(0,t.w5)((()=>[(0,t.Uk)("取消")])),_:1}),(0,t.Wm)(y,{type:"primary",onClick:w},{default:(0,t.w5)((()=>[(0,t.Uk)("确定")])),_:1})])])),default:(0,t.w5)((()=>[(0,t.Wm)(b,{model:c.value},{default:(0,t.w5)((()=>[(0,t.Wm)(u,null,{default:(0,t.w5)((()=>[(0,t.Wm)(d,{modelValue:g.value,"onUpdate:modelValue":a[0]||(a[0]=e=>g.value=e),indeterminate:m.value,onChange:f},{default:(0,t.w5)((()=>[(0,t.Uk)("全选")])),_:1},8,["modelValue","indeterminate"])])),_:1}),(0,t.Wm)(u,null,{default:(0,t.w5)((()=>[(0,t.Wm)(i,{modelValue:c.value.checkedRoleIdList,"onUpdate:modelValue":a[1]||(a[1]=e=>c.value.checkedRoleIdList=e),onChange:h},{default:(0,t.w5)((()=>[((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)(c.value.roleList,(e=>((0,t.wg)(),(0,t.j4)(d,{key:e.id,label:e.id,name:"roleList"},{default:(0,t.w5)((()=>[(0,t.Uk)((0,s.zw)(e.name),1)])),_:2},1032,["label"])))),128))])),_:1},8,["modelValue"])])),_:1})])),_:1},8,["model"])])),_:1},8,["modelValue"])}}});const g=c;var m=g}}]);
//# sourceMappingURL=757.0867b9f1.js.map