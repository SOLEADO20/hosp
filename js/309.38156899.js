"use strict";(self["webpackChunkhosp"]=self["webpackChunkhosp"]||[]).push([[309],{309:function(e,l,o){o.r(l),o.d(l,{default:function(){return p}});o(7658);var a=o(3396),t=o(4870),d=o(4901),r=o(7178),i=o(2655),n=o(2748);const u={class:"dialog-footer"},s={name:"EditDialog"};var c=Object.assign(s,{props:{editDialogVisible:{type:Boolean,required:!0,default:!1},id:{type:Number,required:!0,default:-1},title:{type:String,required:!0,default:""}},emits:["update:editDialogVisible","handleSubmit"],setup(e,{emit:l}){const o=e,s=(0,a.Fl)({get(){return o.editDialogVisible},set(e){l("update:editDialogVisible",e)}}),c=(0,t.iH)({id:-1,departmentId:0,doctorId:-1,doctorInfo:{id:-1,name:"",idNo:"",sex:!1,tel:"",disabled:!1,note:""},disabled:!1}),m=(0,t.iH)(""),p=(0,t.iH)(""),f=(0,t.iH)([]),g=async(e,l,o)=>{let a;if(console.log(e.field),console.log(l),"departmentId"==e.field?a="/api/bsns/workers/checkWorker?id="+c.value.id+"&departmentId="+l+"&doctorId="+c.value.doctorId:"doctorId"==e.field?l&&-1==l?o(new Error("请选择人员")):a="/api/bsns/workers/checkWorker?id="+c.value.id+"&departmentId="+c.value.departmentId+"&doctorId="+l:"doctorInfo.disabled"==e.field&&(l?o(new Error("黑名单人员，禁止入职")):o()),console.log(a),a){let e=await d.ZP.post(a);1==e.data.code?o(new Error(e.data.msg)):o()}},v=(0,t.qj)({departmentId:[{required:!0,message:"科室不能为空",trigger:"blur"},{validator:g,trigger:"change"},{validator:g,trigger:"blur"}],doctorId:[{required:!0,message:"人员不能为空",trigger:"blur"},{validator:g,trigger:"blur"}],disabled:[{required:!0,message:"状态不能为空",trigger:"blur"}],"doctorInfo.disabled":[{validator:g,trigger:"change"},{validator:g,trigger:"blur"}]}),b=(0,t.iH)(null),w=async e=>{if(-1==e)c.value={id:-1,departmentId:0,doctorId:-1,doctorInfo:{id:-1,name:"",idNo:"",sex:!1,tel:"",disabled:!1,note:""},disabled:!1},console.log("清空表单...");else{let l=await d.ZP.get("/api/bsns/workers/"+e);if(console.log(l.data),20010==l.data.code){let e=l.data.worker;c.value=e}else(0,r.z8)({message:l.data.msg,type:"error"});console.log("从后台填充...")}m.value="",p.value="";let l=await d.ZP.get("/api/bsns/departments");if(console.log(l.data),20010==l.data.code){let e=[];l.data.departmentList.forEach((l=>{l.name="+ "+l.name,e.push(l),l.children.forEach((l=>{l.name="••• "+l.name,e.push(l)}))})),f.value=e}else(0,r.z8)({message:l.data.msg,type:"error"}),f.value=[]},h=e=>{i.T.confirm("确认在未保存的情况下关闭对话框？").then((()=>{e()})).catch((()=>{}))},I=()=>{s.value=!1},y=()=>{b.value.validate((async e=>{if(e){let e,o;-1==c.value.id?(console.log("提交新增..."),e="/api/bsns/workers",o=await d.ZP.post(e,c.value),console.log("新增岗位 res.data= ",o.data)):(console.log("提交修改..."),e="/api/bsns/workers",o=await d.ZP.put(e,c.value),console.log("修改岗位 res.data= ",o.data)),20020==o.data.code||20030==o.data.code?((0,r.z8)({message:o.data.msg,type:"success"}),l("handleSubmit"),I()):(0,r.z8)({message:o.data.msg,type:"error"})}}))},V=e=>{console.log(e),p.value=m.value,c.value.doctorId=e.personInfo.id,c.value.doctorInfo=e.personInfo,console.log(c.value)};let W=null;const k=(e,l)=>{console.log("queryString=",e),clearTimeout(W),W=setTimeout((async()=>{try{m.value=e;let o=await d.ZP.get("/api/sys/persons?pageSize=50&currentPage=1&query="+e);if(console.log(o.data),20010==o.data.code){let e=[];o.data.personList.forEach((l=>{let o={value:l.name+" . "+("0"==l.sex?"男":"女")+" . "+l.tel+" . "+l.idNo,personInfo:l};e.push(o)})),l(e)}else l()}catch(o){(0,r.z8)({message:o,type:"error"}),l()}}),300*Math.random())};return(0,a.YP)(s,(e=>{1==e&&w(o.id)})),(l,o)=>{const d=(0,a.up)("el-option"),r=(0,a.up)("el-select"),i=(0,a.up)("el-form-item"),m=(0,a.up)("el-autocomplete"),g=(0,a.up)("el-divider"),W=(0,a.up)("el-input"),_=(0,a.up)("el-switch"),U=(0,a.up)("el-form"),x=(0,a.up)("el-button"),q=(0,a.up)("el-dialog");return(0,a.wg)(),(0,a.j4)(q,{modelValue:(0,t.SU)(s),"onUpdate:modelValue":o[9]||(o[9]=e=>(0,t.dq)(s)?s.value=e:null),title:e.title,"before-close":h,width:"600px",draggable:""},{footer:(0,a.w5)((()=>[(0,a._)("span",u,[(0,a.Wm)(x,{onClick:o[8]||(o[8]=l=>w(e.id))},{default:(0,a.w5)((()=>[(0,a.Uk)("重置")])),_:1}),(0,a.Wm)(x,{onClick:I},{default:(0,a.w5)((()=>[(0,a.Uk)("取消")])),_:1}),(0,a.Wm)(x,{type:"primary",onClick:y},{default:(0,a.w5)((()=>[(0,a.Uk)("确定")])),_:1})])])),default:(0,a.w5)((()=>[(0,a.Wm)(U,{ref_key:"editFormRef",ref:b,model:c.value,rules:v,inline:"","label-width":"80px","label-position":"right","status-icon":""},{default:(0,a.w5)((()=>[(0,a.Wm)(i,{label:"科室",prop:"departmentId",style:{width:"48%"}},{default:(0,a.w5)((()=>[(0,a.Wm)(r,{modelValue:c.value.departmentId,"onUpdate:modelValue":o[0]||(o[0]=e=>c.value.departmentId=e),placeholder:"请选择科室"},{default:(0,a.w5)((()=>[(0,a.Wm)(d,{label:"顶级科室",value:0}),((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(f.value,(e=>((0,a.wg)(),(0,a.j4)(d,{key:e.id,label:e.name,value:e.id},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),(0,a.Wm)(i,{label:"人员",prop:"doctorId",style:{width:"100%"}},{default:(0,a.w5)((()=>[(0,a.Wm)(m,{modelValue:p.value,"onUpdate:modelValue":o[1]||(o[1]=e=>p.value=e),"fetch-suggestions":k,onSelect:V,placeholder:"搜索人员...",debounce:300,"highlight-first-item":"",clearable:"",style:{width:"100%"}},null,8,["modelValue"])])),_:1}),(0,a.Wm)(g,{"content-position":"center"},{default:(0,a.w5)((()=>[(0,a.Uk)("所选人员信息")])),_:1}),(0,a.Wm)(i,{label:"姓名",prop:"doctorInfo.name",style:{width:"48%"}},{default:(0,a.w5)((()=>[(0,a.Wm)(W,{modelValue:c.value.doctorInfo.name,"onUpdate:modelValue":o[2]||(o[2]=e=>c.value.doctorInfo.name=e),disabled:""},null,8,["modelValue"])])),_:1}),(0,a.Wm)(i,{label:"电话",prop:"doctorInfo.tel",style:{width:"40%"}},{default:(0,a.w5)((()=>[(0,a.Wm)(W,{modelValue:c.value.doctorInfo.tel,"onUpdate:modelValue":o[3]||(o[3]=e=>c.value.doctorInfo.tel=e),disabled:""},null,8,["modelValue"])])),_:1}),(0,a.Wm)(i,{label:"身份证号",prop:"doctorInfo.idNo",style:{width:"100%"}},{default:(0,a.w5)((()=>[(0,a.Wm)(W,{modelValue:c.value.doctorInfo.idNo,"onUpdate:modelValue":o[4]||(o[4]=e=>c.value.doctorInfo.idNo=e),disabled:""},null,8,["modelValue"])])),_:1}),(0,a.Wm)(i,{label:"性别",prop:"doctorInfo.sex",style:{width:"48%"}},{default:(0,a.w5)((()=>[(0,a.Wm)(_,{modelValue:c.value.doctorInfo.sex,"onUpdate:modelValue":o[5]||(o[5]=e=>c.value.doctorInfo.sex=e),style:{"--el-switch-on-color":"#f89898","--el-switch-off-color":"#409EFF"},"active-icon":(0,t.SU)(n.Female),"inactive-icon":(0,t.SU)(n.Male),"active-value":!0,"inactive-value":!1,width:"50px",disabled:""},null,8,["modelValue","active-icon","inactive-icon"])])),_:1}),(0,a.Wm)(i,{label:"状态",prop:"doctorInfo.disabled",style:{width:"40%"}},{default:(0,a.w5)((()=>[(0,a.Wm)(_,{modelValue:c.value.doctorInfo.disabled,"onUpdate:modelValue":o[6]||(o[6]=e=>c.value.doctorInfo.disabled=e),style:{"--el-switch-on-color":"#13ce66","--el-switch-off-color":"#ff4949"},"active-text":"启用","inactive-text":"禁用","active-value":!1,"inactive-value":!0,width:"50px",disabled:""},null,8,["modelValue"])])),_:1}),(0,a.Wm)(i,{label:"备注",prop:"doctorInfo.note",style:{width:"100%"}},{default:(0,a.w5)((()=>[(0,a.Wm)(W,{modelValue:c.value.doctorInfo.note,"onUpdate:modelValue":o[7]||(o[7]=e=>c.value.doctorInfo.note=e),type:"textarea",rows:5,disabled:""},null,8,["modelValue"])])),_:1})])),_:1},8,["model","rules"])])),_:1},8,["modelValue","title"])}}});const m=c;var p=m}}]);
//# sourceMappingURL=309.38156899.js.map